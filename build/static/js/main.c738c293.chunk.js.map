{"version":3,"sources":["components/QuickPreviewButton.js","components/DynInput.js","Config.js","rav3-jsonapi-client/errors.ts","rav3-jsonapi-client/default-settings.ts","rav3-jsonapi-client/resourceLookup.ts","rav3-jsonapi-client/ra-jsonapi-client.ts","components/AttrForm.js","components/JoinModal.js","util.js","components/InfoModal.js","components/DynInstance.js","components/DynFields.js","components/DynList.js","components/DynResourceEdit.js","DynResource.js","components/ConfigurationUI.js","components/ValH.js","components/Home.js","components/Menu.js","components/Layout.js","createAdminStore.js","authprovider.js","pages/LoginPage.js","App.js","reportWebVitals.js","index.js","get_Component.js"],"names":["useStyles","makeStyles","field","display","maxWidth","QuickPreviewButton","resource_name","id","useState","showPanel","setShowPanel","data","useGetOne","conf","useConf","handleCloseClick","console","log","attr_show","resources","attributes","map","attr","TextField","source","name","Button","onClick","label","Drawer","anchor","open","onClose","SimpleShowLayout","record","basePath","resource","QuickCreateButton","onChange","cb_set_id","showDialog","setShowDialog","useCreate","create","loading","notify","useNotify","form","useForm","handleSubmit","values","a","payload","onSuccess","change","onFailure","error","message","title","type","Dialog","fullWidth","DialogTitle","FormWithRedirect","save","render","handleSubmitWithRedirect","pristine","saving","DialogContent","Grid","container","spacing","margin","m","filter","relationship","attribute","xs","DialogActions","disabled","SaveButton","root","alignItems","spySubscription","DynReferenceInput","props","version","setVersion","useFormState","subscription","selected","setSelected","handleChange","useCallback","event","item","ReferenceInput","AutocompleteInput","optionText","evt","target","value","reference","DynInput","input_props","validate","required","selected_ref","setSelected_ref","GridWrap","children","attr_type","toLowerCase","result","TextInput","multiline","component","Component","get_Component","mode","DateInput","PasswordInput","NumberInput","direction","search_cols","length","warn","ri_props","v","allowEmpty","getLSConf","lsc_str","localStorage","getItem","JSON","parse","stringify","config","Object","entries","e","setItem","json2Conf","settings","relationships","tab_groups","Array","tg","push","tab_group_name","tab_group","assign","sort_attr_names","constructor","rel","fks","fk","target_resource","search","sort","join","replace","col","user_key","max_list_columns","debug","locale","options","defaultOptions","languageCodeOnly","opt","browserLocales","undefined","navigator","languages","language","trimmedLocale","trim","split","getBrowserLocales","reset_Conf","getConf","window","location","reload","configs","api_root","default_configs","SafrsHttpError","Error","status","body","HttpError","defaultSettings","total","headers","Accept","updateMethod","arrayFormat","includeRelations","errorHandler","httpError","errors","alert","code","endpointToTypeStripLastLetters","ResourceLookup","response","lookup","includes","this","Map","prototype","hasOwnProperty","call","included","entry","key","getKey","set","has","get","ret","ja_type","duration","prepareAttributes","resource_attr_rels","m_attrs","k","find","n","toString","prepareQueryFilter","query","ids","i","httpAuthClient","url","Headers","token","fetchUtils","fetchJson","jsonapiClient","apiUrl","userSettings","httpClient","countHeader","merge","getList","params","pagination","page","perPage","resource_conf","q","op","val","format","keys","forEach","prefix","order","then","json","meta","jsonData","unwrapData","validUntil","Date","setTime","getTime","catch","err","Promise","reject","getOne","getMany","getManyReference","update","arr","endsWith","slice","method","updateMany","all","responses","delete","deleteMany","getResources","resolve","edit_grid","width","AttrForm","classes","SimpleForm","className","hidden","Fragment","style","position","top","left","transform","bgcolor","border","boxShadow","p","textAlign","joined_field","cursor","color","JoinModal","content","React","setOpen","stopPropagation","Modal","Box","sx","Typography","variant","mt","type2resource","DynPagination","Pagination","rowsPerPageOptions","InfoPopover","anchorEl","setAnchorEl","Boolean","currentTarget","onMouseOver","Popover","anchorOrigin","vertical","horizontal","info_modal","icon","InfoModal","dangerouslySetInnerHTML","__html","join_attr","delete_icon","fill","rel_icon","paddingLeft","marginBottom","many_tab","instance_title","ResourceTitle","DetailPanel","ShowRecordField","tabs","useRecordContext","attr_name","ShowInstance","tab","Tab","DynRelationshipMany","DynRelationshipOne","TabbedShowLayout","TabbedShowLayoutTabs","scrollButtons","rel_data","setRelData","setLoading","rel_error","setRelError","useQueryWithStore","loaded","rel_id","dataProvider","useDataProvider","tab_content","useEffect","instance","rel_resource","Loading","LoadingRelatedInstance","setError","setRelated","r_attr","fields","attr_fields","col_nr","ReferenceManyField","addLabel","Datagrid","rowClick","expand","EditButton","RelatedInstance","Link","to","pathname","ShowActions","TopToolbar","RelLabel","text","Tooltip","placement","arrow","height","paddingTop","TruncatedTextField","isValidElement","Function","NestedJoinedField","modal_content","JoinedField","pvalue","rel_name","user_component","component_name","LabelComponent","loadable","resolveComponent","components","load_custom_component","ToOneJoin","label_text","AttrField","sortBy","DateField","locales","ShowField","trunc_size","Number","full_text","setFullText","shown","outlined","ShowAttrField","info","field_props","jf","rel_label","searchFilters","alwaysOn","DeleteButton","refresh","useRefresh","FunctionField","Confirm","isOpen","onConfirm","deleteField","ListActions","FilterButton","CreateButton","ExportButton","gen_DynResourceList","ButtonField","filtered_props","startsWith","edit","ShowButton","ListTitle","document","list","filters","actions","Wrapper","DynEdit","DynResource","addEventListener","List","useMemo","Create","history","useHistory","CreateComp","goBack","Edit","redirect","useRedirect","mutationMode","gen_DynResourceEdit","Show","show","gen_DynResourceShow","Resource","yaml","require","als_yaml_url","href","theme","widget","marginRight","marginTop","textInput","modal","addConf","LoadYaml","config_url","saveYaml","ystr","load","fetch","cache","conf_str","r","saveConf","ManageModal","config_list","conf_name","confirm","DeleteConf","textFieldRef","useRef","inputRef","current","ConfSelect","current_conf","setCurrent","minWidth","FormControl","InputLabel","Select","labelId","size","new_conf","defaultValue","MenuItem","resetConf","defconf","ConfigurationUI","saveEdit","parsed_conf","setApiroot","setBgColor","taConf","setTaConf","bgColor","autosave","setAutosave","Editor","saveConfig","FormControlLabel","control","Checkbox","checked","fallback","dump","borderLeft","ev","jj","TextareaAutosize","minRows","backgroundColor","Accordion","styled","disableGutters","elevation","square","palette","divider","borderBottom","AccordionSummary","expandIcon","fontSize","flexDirection","marginLeft","AccordionDetails","MuiAccordionDetails","padding","borderTop","CustomizedAccordions","align","lineHeight","Demo","ready","setContent","getContent","withStyles","home","fontFamily","scriptLoaded","setScriptLoaded","initialized","setInitialized","init","HomeJS","onError","onLoad","Home","HomeComp","Card","Title","CardContent","spacer","flex","menu","ConfigurationMenu","forwardRef","ref","translate","useTranslate","MenuItemLink","primaryText","leftIcon","sidebarIsOpen","CustomUserMenu","UserMenu","CustomAppBar","AppBar","userMenu","onMenuClick","Menu","useSelector","Layout","appBar","sReducer","previousState","instance2store","rel_resource_name","isArray","rel_inst","adminReducerWrapper","action","adminReducer","inc_resources","Set","add","authProvider","reducer","combineReducers","admin","router","connectRouter","saga","rootSaga","adminSaga","fork","sagaMiddleware","createSagaMiddleware","composeEnhancers","compose","store","createStore","state","USER_LOGOUT","applyMiddleware","routerMiddleware","run","dummy_auth","login","username","password","login_url","requestOptions","statusText","auth_token","logout","cookies","cookie","eqPos","indexOf","substr","checkError","checkAuth","auth_url","iat","atob","now","exc","getPermissions","paper","avatar","secondary","main","submit","connect","userLogin","setusername","setpassword","setLoaded","dispatch","useDispatch","hideNotification","hostname","finally","Container","CssBaseline","Avatar","noValidate","onSubmit","preventDefault","credentials","autoComplete","autoFocus","createHashHistory","bcR","AsyncResources","setResources","res","createAdminStore","AdminUI","layout","loginPage","LoginPage","disableTelemetry","HomeIcon","SettingsIcon","App","cacheDataProviderProxy","AdminContext","customReducers","admin2","reportWebVitals","onPerfEntry","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.c738c293.chunk.js","sourcesContent":["import React, { useState } from 'react';\r\nimport Drawer from '@material-ui/core/Drawer';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport {useConf} from '../Config.js'\r\nimport IconImageEye from '@material-ui/icons/RemoveRedEye';\r\nimport IconKeyboardArrowRight from '@material-ui/icons/KeyboardArrowRight';\r\nimport { Button, SimpleShowLayout, TextField, useGetOne } from 'react-admin';\r\n\r\n\r\nconst useStyles = makeStyles({\r\n    field: {\r\n        // These styles will ensure our drawer don't fully cover our\r\n        // application when teaser or title are very long\r\n        '& span': {\r\n            display: 'inline-block',\r\n            maxWidth: '20em'\r\n        }\r\n    }\r\n});\r\n\r\nconst QuickPreviewButton = ({resource_name, id }) => {\r\n    const [showPanel, setShowPanel] = useState(false);\r\n    const classes = useStyles();\r\n    const { data } = useGetOne(resource_name, id);\r\n    const conf = useConf();\r\n\r\n    const handleClick = () => {\r\n        setShowPanel(true);\r\n    };\r\n\r\n    const handleCloseClick = () => {\r\n        setShowPanel(false);\r\n    };\r\n\r\n    console.log(resource_name, id)\r\n\r\n    const attr_show = conf.resources[resource_name].attributes.map((attr) => <TextField source={attr.name} />)\r\n    return (\r\n        <>\r\n            <Button onClick={handleClick} label=\"ra.action.show\">\r\n                <IconImageEye />\r\n            </Button>\r\n            <Drawer anchor=\"right\" open={showPanel} onClose={handleCloseClick}>\r\n                <div>\r\n                    <Button label=\"Close\" onClick={handleCloseClick}>\r\n                        <IconKeyboardArrowRight />\r\n                    </Button>\r\n                </div>\r\n                <SimpleShowLayout\r\n                    record={data}\r\n                    basePath=\"/\"\r\n                    resource={resource_name}\r\n                >\r\n                    {attr_show}\r\n                </SimpleShowLayout>\r\n            </Drawer>\r\n        </>\r\n    );\r\n};\r\n\r\nexport default QuickPreviewButton;\r\n","import {\r\n    TextInput,\r\n    DateInput,\r\n    ReferenceInput,\r\n    AutocompleteInput,\r\n    NumberInput,\r\n    SelectInput,\r\n    PasswordInput,\r\n    required,\r\n    useCreate,\r\n    useNotify,\r\n    Button,\r\n    SaveButton,\r\n    FormWithRedirect\r\n} from 'react-admin'\r\nimport { useForm } from 'react-final-form';\r\nimport React, { useState, useCallback } from 'react';\r\nimport { useFormState } from 'react-final-form';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport IconContentAdd from '@material-ui/icons/Add';\r\nimport IconCancel from '@material-ui/icons/Cancel';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport {useConf} from '../Config.js'\r\nimport QuickPreviewButton from './QuickPreviewButton.js'\r\nimport get_Component from \"../get_Component\";\r\n\r\nfunction QuickCreateButton({ onChange, resource_name, cb_set_id }) {\r\n    \r\n    const [showDialog, setShowDialog] = useState(false);\r\n    const [create, { loading }] = useCreate(resource_name);\r\n    const notify = useNotify();\r\n    const form = useForm();\r\n    const conf = useConf();\r\n    const resource = conf.resources[resource_name]\r\n    const attributes = resource?.attributes || []\r\n\r\n    const handleClick = () => {\r\n        setShowDialog(true);\r\n    };\r\n\r\n    const handleCloseClick = () => {\r\n        setShowDialog(false);\r\n    };\r\n\r\n    const handleSubmit = async values => {\r\n        create(\r\n            { payload: { data: values } },\r\n            {\r\n                onSuccess: ({ data }) => {\r\n                    setShowDialog(false);\r\n                    // Update the form to target the newly created item\r\n                    // Updating the ReferenceInput value will force it to reload the available posts\r\n                    form.change('id', data.id);\r\n                    cb_set_id(data.id)\r\n                    onChange();\r\n                },\r\n                onFailure: ({ error }) => {\r\n                    notify(error.message, 'error');\r\n                }\r\n            }\r\n        );\r\n    };\r\n    const title = `Create ${resource.type}`\r\n    return (\r\n        <>\r\n            <Button onClick={handleClick} label=\"ra.action.create\">\r\n                <IconContentAdd />\r\n            </Button>\r\n            <Dialog\r\n                fullWidth\r\n                maxWidth=\"md\"\r\n                open={showDialog}\r\n                onClose={handleCloseClick}\r\n                aria-label={title}\r\n            >\r\n                <DialogTitle>{title}</DialogTitle>\r\n\r\n                <FormWithRedirect\r\n                    resource={resource_name}\r\n                    save={handleSubmit}\r\n                    render={({\r\n                        handleSubmitWithRedirect,\r\n                        pristine,\r\n                        saving\r\n                    }) => (\r\n                        <>\r\n                            <DialogContent>\r\n                                <Grid container spacing={2} margin={2} m={40}>\r\n                                {attributes.filter(attr => !attr.relationship).map((attr) => <DynInput attribute={attr} key={attr.name}/> )}\r\n                                </Grid>\r\n                                <Grid container spacing={2} margin={2} m={40} xs={4}>\r\n                                {attributes.filter(attr => attr.relationship).map((attr) => <DynInput attribute={attr} key={attr.name} xs={8}/> )}\r\n                                </Grid>\r\n                            </DialogContent>\r\n                            <DialogActions>\r\n                                <Button\r\n                                    label=\"ra.action.cancel\"\r\n                                    onClick={handleCloseClick}\r\n                                    disabled={loading}\r\n                                >\r\n                                    <IconCancel />\r\n                                </Button>\r\n                                <SaveButton\r\n                                    handleSubmitWithRedirect={\r\n                                        handleSubmitWithRedirect\r\n                                    }\r\n                                    pristine={pristine}\r\n                                    saving={saving}\r\n                                    disabled={loading}\r\n                                />\r\n                            </DialogActions>\r\n                        </>\r\n                    )}\r\n                />\r\n            </Dialog>\r\n        </>\r\n    );\r\n}\r\n\r\n\r\nconst useStyles = makeStyles({\r\n    root: {\r\n        display: 'flex',\r\n        alignItems: 'center'\r\n    }\r\n});\r\n\r\nconst spySubscription = { values: true };\r\n\r\nconst DynReferenceInput = (props) => {\r\n    const classes = useStyles();\r\n    const [version, setVersion] = useState(0);\r\n    const { values } = useFormState({ subscription: spySubscription });\r\n    const [selected, setSelected] = useState(props.selected)\r\n    const handleChange = useCallback((event) => setVersion(version + 1), [version]);\r\n    \r\n    return <>\r\n            <Grid item xs={4} spacing={4} margin={5} >\r\n                <ReferenceInput key={version} {...props}>\r\n                    <AutocompleteInput  optionText={props.optionText} key={props.source} onChange={(evt) => setSelected(evt.target.value)} />\r\n                </ReferenceInput>\r\n            </Grid>\r\n            <Grid item xs={2} spacing={4} margin={5} >\r\n                <QuickCreateButton onChange={handleChange} resource_name={props.reference} cb_set_id={props.cb_set_id}/>\r\n                {selected && <QuickPreviewButton id={props.selected} resource_name={props.reference}/> }\r\n            </Grid>\r\n        </>\r\n};\r\n\r\nconst DynInput = ({attribute, resource, xs}) => {\r\n\r\n    const label = attribute.label || attribute.name\r\n    const input_props = {validate : attribute.required ? required() : false , label: label}\r\n    \r\n    const [selected_ref, setSelected_ref] = useState(false)\r\n    const GridWrap = (props) => <Grid item xs={xs | 4} spacing={4} margin={5} >{props.children}</Grid>\r\n    const attr_type = attribute.type?.toLowerCase()\r\n    let result = <GridWrap><TextInput source={attribute.name} fullWidth multiline={attribute.multiline} {...input_props}/></GridWrap>\r\n    const conf = useConf();\r\n\r\n    if(attribute.component){\r\n        const Component = get_Component(attribute.component)\r\n        return <Component attr={attribute} mode=\"edit\"/>\r\n    }\r\n    if(attr_type == \"date\"){\r\n        result = <GridWrap><DateInput source={attribute.name} fullWidth /></GridWrap>\r\n    }\r\n    if(attr_type == \"password\"){\r\n        result = <GridWrap><PasswordInput source={attribute.name} key={attribute.name}/></GridWrap>\r\n    }\r\n    if(attr_type == \"number\" || attr_type == \"decimal\"){\r\n        result = <GridWrap><NumberInput source={attribute.name} fullWidth={false}  {...input_props}/></GridWrap>\r\n    }\r\n\r\n    if(attribute.relationship?.direction == \"toone\" && attribute.relationship.target){\r\n        const search_cols = conf.resources[attribute.relationship.target].search_cols\r\n        let optionText = \"\"\r\n        \r\n        if(!search_cols){\r\n            console.error(\"no searchable attributes configured\");\r\n        }\r\n        else if(search_cols.length == 0){\r\n            console.warn(`no searchable attributes configured for ${attribute.relationship.target}`);\r\n        }\r\n        else{\r\n            optionText = search_cols[0].name\r\n        }\r\n        /*result = <ReferenceInput source={attribute.name}\r\n                                 label={`${attribute.relationship.name} (${attribute.name})`}\r\n                                 reference={attribute.relationship.target}\r\n                                 resource={attribute.relationship.resource}\r\n                                 fullWidth>\r\n                    <AutocompleteInput optionText={optionText} key={attribute.name} id={0}/>\r\n                </ReferenceInput>*/\r\n        const ri_props = {}\r\n        if(selected_ref){\r\n            ri_props['defaultValue'] = selected_ref\r\n        }\r\n        result = <DynReferenceInput \r\n                    source={attribute.name}\r\n                    label={`${attribute.relationship.name} (${attribute.name})`}\r\n                    reference={attribute.relationship.target}\r\n                    resource={attribute.relationship.resource}\r\n                    fullWidth\r\n                    optionText={optionText}\r\n                    cb_set_id={(v)=>{setSelected_ref(v)} }\r\n                    allowEmpty={!attribute.required}\r\n                    selected={selected_ref}\r\n                    {...ri_props}\r\n                    />\r\n                    \r\n    }\r\n    \r\n    return result\r\n}\r\n\r\nexport default DynInput","import React, { useState, useEffect } from 'react';\r\nimport config from './Config.json'\r\nimport { useRefresh } from \"react-admin\"\r\n//import als_config from './Config.als.json'\r\n\r\nconst useQuery = () => {\r\n    //const search = useLocation() || \"\";\r\n    //console.log(search)\r\n    //return React.useMemo(() => new URLSearchParams(search), [search])\r\n}\r\n\r\nconst init_Conf = () => {\r\n    const selected_api = null\r\n    if(selected_api){\r\n        const configs = JSON.parse(localStorage.getItem(\"raconfigs\") || {})\r\n        if(selected_api in configs){\r\n            alert()\r\n        }\r\n    }\r\n    if(! \"raconf\" in localStorage){\r\n        console.log(\"Init Configuration\")\r\n        localStorage.setItem(\"raconf\",JSON.stringify(config))\r\n        window.location.reload()\r\n    }\r\n}\r\n\r\nconst getBrowserLocales = (options = {}) => {\r\n    const defaultOptions = {\r\n      languageCodeOnly: false,\r\n    };\r\n    const opt = {\r\n      ...defaultOptions,\r\n      ...options,\r\n    };\r\n    const browserLocales =\r\n      navigator.languages === undefined\r\n        ? [navigator.language]\r\n        : navigator.languages;\r\n    if (!browserLocales) {\r\n      return undefined;\r\n    }\r\n    return browserLocales.map(locale => {\r\n      const trimmedLocale = locale.trim();\r\n      return opt.languageCodeOnly\r\n        ? trimmedLocale.split(/-|_/)[0]\r\n        : trimmedLocale;\r\n    });\r\n  }\r\n\r\n\r\nexport const getLSConf = () => {\r\n    let result = {}\r\n    const lsc_str = localStorage.getItem(\"raconf\")\r\n    let ls_conf = null\r\n    try{\r\n        ls_conf = JSON.parse(lsc_str)\r\n        result = ls_conf ? ls_conf : JSON.parse(JSON.stringify(config)) || {};\r\n        Object.entries(result.resources)\r\n    }\r\n    catch(e){\r\n        console.warn(`Failed to parse config ${lsc_str}`)\r\n        localStorage.setItem(\"raconf\", JSON.stringify(config))\r\n    }\r\n    return result\r\n}\r\n\r\n\r\nconst json2Conf = (conf) => {\r\n    \r\n    let result = conf\r\n    if(!result.resources){\r\n        result.resources = {}\r\n    }\r\n    if(!result.settings){\r\n        result.settings = {}\r\n    }\r\n    const resources = result.resources\r\n\r\n    for(let [resource_name, resource] of Object.entries(resources||{})){\r\n        resource.relationships = resource.relationships || []\r\n        if(resource.tab_groups instanceof Array){\r\n            for(let tg of resource.tab_groups){\r\n                if(!tg.direction){\r\n                    continue\r\n                }\r\n                tg.target = tg.resource\r\n                resource.relationships.push(tg)\r\n            }\r\n            //resource.relationships = resource.relationships.concat(resource.tab_groups)\r\n        }\r\n        else {\r\n            // dict: deprecated soon\r\n            for(let [tab_group_name, tab_group] of Object.entries(resource.tab_groups || {}) ){\r\n                resource.relationships.push(Object.assign(tab_group, {name: tab_group_name, target: tab_group.resource}))\r\n            }\r\n        }\r\n        // link relationship to FK column\r\n        if(!(resource.attributes instanceof Array || resource.relationships instanceof Array)){\r\n            continue\r\n        }\r\n\r\n        if(!resource.type){\r\n            resource.type = resource_name\r\n        }\r\n\r\n        resource.search_cols = []\r\n        resource.sort_attr_names = []\r\n        result.resources[resource_name].name = resource_name\r\n        let attributes = resource.attributes || []\r\n\r\n        for(let attr of attributes){\r\n            if(!(attr.constructor == Object)){\r\n                console.warn(`Invalid attribute ${attr}`)\r\n                continue\r\n            }\r\n            for(let rel of resource.relationships || []){\r\n                for(let fk of rel.fks || []){\r\n                    if(attr.name == fk){\r\n                        attr.relationship = rel;\r\n                        attr.relationship.target_resource = result.resources[attr.relationship.target] || result.resources[attr.relationship.resource]\r\n                    }\r\n                }\r\n            }\r\n            if(attr.search){\r\n                resource.search_cols.push(attr);\r\n            }\r\n            if(attr.sort){\r\n                if(attr.sort == \"DESC\"){\r\n                    resource.sort_attr_names.push('-' + attr.name)\r\n                }\r\n                else{\r\n                    resource.sort_attr_names.push(attr.name)\r\n                }\r\n                resource.sort = resource.sort_attr_names.join(',')\r\n            }\r\n            if(!attr.label){\r\n                attr.label = attr.relationship?.resource || attr.name?.replace(/([A-Z])/g, \" $1\").replace(/(_)/g, \" \") // split camelcase/snakecase\r\n            }\r\n            attr.resource = resource\r\n        }\r\n        if(resource.search_cols.length === 0){\r\n            resource.search_cols = attributes.filter((col) => col.name !== false && (col.name === \"id\" || col.name === resource.user_key || col.name === \"name\") )\r\n        }\r\n        resource.max_list_columns = resource.max_list_columns || result.settings?.max_list_columns || 8\r\n        //resource.label = resource.name?.replace(/([A-Z])/g, \" $1\").replace(/(_)/g, \" \") // split camelcase/snakecase\r\n        console.debug(`Loaded config resource ${resource_name}`, resource)\r\n    }\r\n    \r\n    if(result.settings){\r\n        result.settings.locale = result.settings.locale || getBrowserLocales()[0] || \"fr-FR\"\r\n    }\r\n    return result || reset_Conf()\r\n}\r\n\r\nexport const useConf = () => {\r\n\r\n    /*const [conf, setConf] = useState({});\r\n    //window.addEventListener(\"storage\", ()=>setConf(getLSConf()))\r\n    useEffect(() => {\r\n        setConf(getLSConf());\r\n    },[])*/\r\n    let conf = getLSConf()\r\n    return json2Conf(conf)\r\n}\r\n\r\n\r\nexport const getConf = () => {\r\n    init_Conf();\r\n    return json2Conf(getLSConf())\r\n}\r\n\r\n\r\nexport const reset_Conf = (reload) => {\r\n    const configs = {}\r\n    console.log(\"Resetting conf\", config)\r\n    localStorage.setItem(\"raconf\", JSON.stringify(config));\r\n    configs[config.api_root] = config\r\n    //configs[als_config.api_root] = als_config\r\n    \r\n    localStorage.setItem(\"raconfigs\", JSON.stringify(configs));\r\n\r\n    if(reload){\r\n        window.location.reload()\r\n    }\r\n    return config\r\n}\r\n\r\nexport const default_configs = [config]\r\n","import { HttpError, useNotify } from 'react-admin';\n\nexport class NotImplementedError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.message = message;\n    this.name = 'NotImplementedError';\n  }\n}\n\nexport class SafrsHttpError extends HttpError {\n  constructor(message: string, status: number, body: any) {\n    super(message, status, body);\n    this.name = 'SafrsHttpError';\n  }\n}\n\nexport const safrsErrorHandler: HttpErrorHandler = (\n  httpError: HttpError\n): HttpError => {\n  /* Example Safrs Error message\n  {\n    \"errors\": [\n      {\n        \"title\": \"Request forbidden -- authorization will not help\",\n        \"detail\": \"\",\n        \"code\": \"403\"\n      }\n    ]\n  } */\n  interface err {\n    title: string;\n    detail: string;\n    code: string;\n  }\n  \n  const errors: { errors: err[] } = httpError.body; // JSON.parse(httpError.body.stringify);\n  if (errors?.errors?.length > 0) {\n    alert(\"Data error \"+ errors.errors[0].title)\n    return new SafrsHttpError(\n      errors.errors[0].title,\n      httpError.status,\n      errors.errors[0].code\n    );\n  } else {\n    console.log('Unsopported Http Error Body', httpError.body);\n    return httpError;\n  }\n};\n\nexport interface HttpErrorHandler {\n  (httpError: HttpError): HttpError;\n}\n","import { safrsErrorHandler, HttpErrorHandler } from './errors';\nimport { includeRelations } from './ra-jsonapi-client';\n\nexport const defaultSettings: settings = {\n  total: 'total',\n  headers: {\n    Accept: 'application/vnd.api+json; charset=utf-8',\n    'Content-Type': 'application/vnd.api+json; charset=utf-8'\n  },\n  updateMethod: 'PATCH',\n  arrayFormat: 'brackets',\n  includeRelations: [],\n  errorHandler: safrsErrorHandler,\n  endpointToTypeStripLastLetters: ['Model', 's'] // update/create type: UserModel -> User, Users -> User\n};\n\ninterface settings {\n  total: string;\n  headers: {};\n  updateMethod: string;\n  arrayFormat: string;\n  includeRelations: includeRelations[];\n  errorHandler: HttpErrorHandler;\n  endpointToTypeStripLastLetters?: string[];\n}\n","/**\n * A map-like class that maps resource linkage objects {id: 1, type: \"user\"} to concrete resources with attributes and\n * relationships\n */\nexport default class ResourceLookup {\n  lookup: Map<any, any>;\n  includes: string[];\n  /**\n   * Constructs a new lookup map\n   * @param {Object} response A JSON API response, in JSON format\n   */\n  constructor(response: any) {\n    this.lookup = new Map();\n    this.includes = [];\n\n    // If the response wasn't a JSON dictionary, we can't and don't need to build a lookup\n    if (typeof response !== 'object') return;\n\n    let resources;\n    // if (response.hasOwnProperty('included')) {\n    if (Object.prototype.hasOwnProperty.call(response, 'included')) {\n      resources = [...response.data, ...response.included];\n    } else {\n      resources = response.data;\n    }\n\n    // Iterate over each resource returned and put each in the lookup\n    for (const entry of resources) {\n      const key = this.getKey(entry);\n      this.lookup.set(key, entry);\n    }\n  }\n\n  /**\n   * Calculates a hashable key for JSON API resources\n   * @param resource A resource linkage object\n   * @returns {string}\n   */\n  getKey(resource: any) {\n    return `${resource.type}:${resource.id}`;\n  }\n\n  /**\n   * Looks up a resource\n   * @param resource A resource linkage object\n   * @returns {Object}\n   */\n  get(resource: any) {\n    // If we don't have included data for this resource, just return the Resource Linkage object, since that's still\n    // useful\n    if (this.has(resource)) {\n      return this.lookup.get(this.getKey(resource));\n    } else {\n      return resource;\n    }\n  }\n\n  /**\n   * Returns true if the resource is in the lookup\n   * @param resource\n   * @returns {boolean}\n   */\n  has(resource: any) {\n    return this.lookup.has(this.getKey(resource));\n  }\n\n  /**\n   * Converts a JSON API data object (with id, type, and attributes fields) into a flattened object\n   * @param {Object} response A JSON API data object\n   */\n  unwrapData(response: any, includes: string[]) {\n    // The base resource object\n    const ret = Object.assign(\n      {\n        id: response.id,\n        ja_type: response.type\n      },\n      response.attributes\n    );\n    if (includes.length === 0) {\n      // shortcut, no includes: scip relationships\n      return ret;\n    }\n    // Deal with relationships\n\n    if (Object.prototype.hasOwnProperty.call(response, 'relationships')) {\n      ret.relationships = response.relationships;\n      \n    }\n\n    return ret;\n  }\n}\n\nfunction lowerFirstLetter(s: string): string {\n  return s;\n  return s[0].toLowerCase() + s.slice(1);\n}\n","import { stringify } from 'query-string';\nimport { fetchUtils, DataProvider, HttpError } from 'react-admin';\nimport merge from 'deepmerge';\nimport { defaultSettings } from './default-settings';\nimport ResourceLookup from './resourceLookup';\nimport {getConf} from '../Config'\nimport { number } from 'prop-types';\n\nconst conf : { [ key: string] : any } = getConf();\nconst duration = 2000;\n\nconst prepareAttributes = (attributes : any, resource : any) => {\n    // temp: convert all numbers to string to allow FK lookups (jsonapi ids are strings, while FKs may be numbers :////)\n    const resource_attr_rels = conf.resources[resource].attributes?.map( (attr : any) => attr.relationship ? attr.name : null)    \n    const m_attrs = Object.assign({}, attributes)\n    for(let [k, v] of Object.entries(attributes)){\n      m_attrs[k] = v\n      if(typeof v === 'number' && resource_attr_rels.find((n: string) => n == k)){\n        m_attrs[k] = v.toString();\n      }\n    }\n    return m_attrs\n}\n\nconst prepareQueryFilter = (query: any, ids : any, fks : any) => {\n  if(ids.length == fks.length){\n    for(let i = 0; i<fks.length; i++){\n      let fk = fks[i]\n      let id = ids[i]\n      query[`filter[${fk}]`] = id\n    }\n  }\n  else{\n    // fk probably contains an underscore\n    // todo: how to fix???\n    console.warn(\"Wrong FK length.. \", ids, fks)\n    query[`filter[${fks[0]}]`] = ids && ids.length ? ids[0] : \"\"\n  }\n}\n\nexport const httpAuthClient = (url: string, options : any) => {\n  if (!options.headers) {\n      options.headers = new Headers({ Accept: 'application/json' });\n  }\n  const token : string = localStorage.getItem('auth_token') || \"\";\n  options.headers.set('Authorization', `Bearer ${token}`);\n  return fetchUtils.fetchJson(url, options);\n}\n\n/**\n * Based on\n * \n * https://github.com/marmelab/react-admin/blob/master/packages/ra-data-simple-rest/src/index.ts\n * @see https://github.com/marmelab/FakeRest\n * \n */\nexport const jsonapiClient = (\n  apiUrl: string,\n  userSettings = {conf : {}},\n  httpClient = httpAuthClient,//fetchUtils.fetchJson,\n  countHeader: string = 'Content-Range'\n): DataProvider => {\n  const settings = merge(defaultSettings, userSettings);\n  const conf__ = userSettings.conf;\n\n  \n  return {\n    /*******************************************************************************************\n     * getList\n     *******************************************************************************************/\n    getList: (resource, params) => {\n      console.log(params)\n      /*todo: rename resource to resource_name*/\n      const resource_name = resource;\n      const { page, perPage } = params.pagination;\n      \n      const resource_conf : any = conf.resources[resource_name];\n      const sort : string = resource_conf.sort\n      // Create query with pagination params.\n      const query : {[k: string]: any} = {\n        'page[number]': page,\n        'page[size]': perPage,\n        'page[offset]': (page - 1) * perPage,\n        'page[limit]': perPage\n      };\n\n      if(sort){\n          query.sort = sort\n      }\n\n      console.debug(params)\n      console.log(resource_conf)\n      // Add all filter params to query.\n      if(params.filter?.q && \"resources\" in conf){\n          // search is requested by react-admin\n          const search_cols = resource_conf.search_cols\n          const filter = search_cols?.map((col: any) => {\n                              return { \n                                \"name\":col.name,\n                                \"op\": col.op? col.op : \"ilike\",\n                                \"val\": col.val ? col.val.format(params.filter.q) : `%${params.filter.q}%`\n                              };}) || \"\"\n          if(filter){\n            query['filter'] = JSON.stringify(filter)\n          }\n      }\n      else{\n        Object.keys(params.filter || {}).forEach((key) => {\n          query[`filter[${key}]`] = params.filter[key];\n        });\n      }\n\n      // Add sort parameter, first check the default configured sorting, then the customized sort\n      if (params.sort && params.sort.field) {\n          const prefix = params.sort.order === 'DESC' ? '-' : ''; // <> ASC\n          query.sort = `${prefix}${params.sort.field}`;\n      }\n      if(!query.sort){\n          query.sort = resource_conf.sort || \"id\"\n      }\n      console.debug(query)\n      const rel_conf = conf.resources[resource_name].relationships || []\n      // we only need \"toone\" rels in getList so we can show the join/user key\n      const includes: string[] = rel_conf.filter((rel : any) => rel.direction != 'tomany').map((rel : any) => rel.name);\n      query['include'] = includes.join(',');\n\n      const url = `${apiUrl}/${resource}?${stringify(query)}`;\n      return httpClient(url, {})\n        .then(({ json }) => {\n          // const lookup = new ResourceLookup(json.data);\n          // When meta data and the 'total' setting is provided try\n          // to get the total count.\n          let total = 0;\n          if (json.meta && settings.total) {\n            total = json.meta[settings.total];\n          }\n          // Use the length of the data array as a fallback.\n          total = total || json.data.length;\n          const lookup = new ResourceLookup(json);\n          const jsonData = json.data.map((resource: any) =>{\n              return lookup.unwrapData(resource, includes)\n            }\n          );\n          const validUntil = new Date();\n          validUntil.setTime(validUntil.getTime() + duration);\n          return {\n            data: jsonData,\n            included: json.included,\n            validUntil : validUntil,\n            total: total\n          };\n        })\n        .catch((err: HttpError) => {\n          console.log('catch Error', err.body);\n          const errorHandler = settings.errorHandler;\n          return Promise.reject(errorHandler(err));\n        });\n    },\n\n    /*******************************************************************************************\n      getOne\n    ********************************************************************************************/\n    getOne: (resource: any, params: { id: any }) => {\n      \n      if(params.id === null || params.id === undefined){\n          console.debug(`params.id is '${params.id}'`)\n          return new Promise(()=>{return {data: {}}})\n      }\n      const resource_conf = conf[\"resources\"][resource];\n      if(!resource_conf){\n        console.warn(`Invalid resource ${resource}`)\n        return new Promise(()=>{});\n      }\n      const rel_conf = resource_conf?.relationships || [];\n      const includes: string[] = rel_conf.map((rel : any) => rel.name).join(\",\")\n      const url = `${apiUrl}/${resource}/${params.id}?include=${includes}&page[limit]=1`; // we only need 1 include at most\n      \n      return httpClient(url, {}).then(({ json }) => {\n\n        let { id, attributes, relationships, type } = json.data;\n        if(id === undefined){\n          console.log(id, attributes)\n          return {data:{}}\n        }\n        Object.assign(attributes, relationships, {type: type}, {relationships: relationships}, {attributes: {...attributes} });\n        attributes = prepareAttributes(attributes, resource)\n        const validUntil = new Date();\n        validUntil.setTime(validUntil.getTime() + duration);\n        return {\n          data: {\n            id,\n            validUntil : validUntil,\n            ...attributes\n          }\n        };\n      });\n    },\n\n    /*******************************************************************************************\n      getMany\n    ********************************************************************************************/\n    getMany: (resource, params: any) => {\n      resource = capitalize(resource);\n      console.log('getMany:',resource, params)\n      let query = 'filter[id]=' \n      query += params.ids instanceof Array ? params.ids.join(',') : JSON.stringify(params.ids); // fixme\n      const url = `${apiUrl}/${resource}?${query}`;\n      return httpClient(url, {}).then(({ json }) => {\n        console.log('getMany', json);\n        // When meta data and the 'total' setting is provided try\n        // to get the total count.\n        let total = 0;\n        if (json.meta && settings.total) {\n          total = json.meta[settings.total];\n        }\n        // Use the length of the data array as a fallback.\n        total = total || json.data.length; //  { id: any; attributes: any; }\n        const jsonData = json.data.map((value: any) =>\n          Object.assign({ id: value.id, type: value.type }, prepareAttributes(value.attributes, resource))\n        );\n        const validUntil = new Date();\n        validUntil.setTime(validUntil.getTime() + duration);\n        return {\n          data: jsonData,\n          validUntil : validUntil,\n          total: total\n        };\n      });\n    },\n\n    /*******************************************************************************************\n      getManyReference\n    ********************************************************************************************/\n    getManyReference: (resource_name, params : any) => {\n      \n      const { page, perPage } = params.pagination;\n      const { field, order } = params.sort;\n\n      const query: {[k: string]: any} = { };\n\n      if (field) {\n        const prefix = order === 'DESC' ? '-' : ''; // <> ASC\n        query.sort = `${prefix}${field}`;\n      }\n      \n      console.log(params)\n      let fks = params.target.split('_')\n      //const ids = fks.length > 1 ? params.id.split('_') : params.id\n      let ids = params.id.split('_')\n\n      if(ids.length != fks.length){\n          console.log(resource_name, params)\n          console.warn(\"Wrong FK length \", ids, fks)\n          fks = [params.target]\n          ids = [params.id]\n      }\n      \n      prepareQueryFilter(query, ids, fks);\n      \n      query[`page[limit]`] = perPage\n      query[`page[offset]`] = (page - 1) * perPage\n     \n      const options = {};\n      const resource_conf = conf[\"resources\"][resource_name];\n      const rel_conf = resource_conf?.relationships || [];\n      const includes: string[] = rel_conf.map((rel : any) => rel.name).join(\",\")\n      const url = `${apiUrl}/${resource_name}?${stringify(query)}&include=${includes}`\n      console.log(query)\n      return httpClient(url, options).then(({ headers, json }) => {\n        if (!headers.has(countHeader)) {\n          console.debug(\n            `The ${countHeader} header is missing in the HTTP Response. The simple REST data provider expects responses for lists of resources to contain this header with the total number of results to build the pagination. If you are using CORS, did you declare ${countHeader} in the Access-Control-Expose-Headers header?`\n          );\n        }\n        let total = json.meta?.total;\n        if (json.meta && settings.total) {\n          total = json.meta[settings.total];\n        }\n        // Use the length of the data array as a fallback.\n        total = total || json.data.length;\n        const lookup = new ResourceLookup(json);\n        const jsonData = json.data.map((resource: any) =>{\n          return lookup.unwrapData(resource, includes)\n          }\n        );\n\n        return {\n          data: jsonData,\n          total: total\n        };\n      });\n    },\n\n    update: (resource_name, params) => {\n      let type = conf[\"resources\"][resource_name].type;\n      const arr = settings.endpointToTypeStripLastLetters;\n      for (const i in arr) {\n        if (resource_name.endsWith(arr[i])) {\n          type = resource_name.slice(0, arr[i].length * -1);\n          break; // quit after first hit\n        }\n      }\n      const data = {\n        data: {\n          id: params.id,\n          type: type,\n          attributes: params.data\n        }\n      };\n\n      return httpClient(`${apiUrl}/${resource_name}/${params.id}`, {\n        method: settings.updateMethod,\n        body: JSON.stringify(data)\n      })\n        .then(({ json }) => {\n          const { id, attributes } = json.data;\n          return {\n            data: {\n              id,\n              ...attributes\n            }\n          };\n        })\n        .catch((err: HttpError) => {\n          console.log('catch Error', err.body);\n          const errorHandler = settings.errorHandler;\n          return Promise.reject(errorHandler(err));\n        });\n    },\n\n    // simple-rest doesn't handle provide an updateMany route, so we fallback to calling update n times instead\n    updateMany: (resource_name, params) =>\n      // todo : bulk update\n      \n      Promise.all(\n        params.ids.map((id) => {\n          const data = {\n            data: {\n              attributes: params.data\n            }\n          };\n          return httpClient(`${apiUrl}/${resource_name}/${id}`, {\n            method: 'PATCH',\n            body: JSON.stringify(params.data)\n          })\n        })\n      )\n      .then((responses) => ({ data: responses.map(({ json }) => json.id) }))\n      ,\n\n    create: (resource, params) => {\n      let type = resource;\n      const arr = settings.endpointToTypeStripLastLetters;\n      for (const i in arr) {\n        if (resource.endsWith(arr[i])) {\n          type = resource.slice(0, arr[i].length * -1);\n          break; // quit after first hit\n        }\n      }\n      const data = {\n        data: {\n          type: type,\n          attributes: params.data\n        }\n      };\n      return httpClient(`${apiUrl}/${resource}`, {\n        method: 'POST',\n        body: JSON.stringify(data)\n      })\n        .then(({ json }) => {\n          const { id, attributes } = json.data;\n          return {\n            data: {\n              id,\n              ...attributes\n            }\n          };\n        })\n        .catch((err: HttpError) => {\n          console.log('catch Error', err.body);\n          const errorHandler = settings.errorHandler;\n          return Promise.reject(errorHandler(err));\n        });\n    },\n\n    delete: (resource, params) =>\n      httpClient(`${apiUrl}/${resource}/${params.id}`, {\n        method: 'DELETE',\n        headers: new Headers({\n          'Content-Type': 'text/plain'\n        })\n      }).then(({ json }) => ({ data: json })),\n\n    // simple-rest doesn't handle filters on DELETE route, so we fallback to calling DELETE n times instead\n    deleteMany: (resource, params) =>\n      Promise.all(\n        params.ids.map((id) =>\n          httpClient(`${apiUrl}/${resource}/${id}`, {\n            method: 'DELETE',\n            headers: new Headers({\n              'Content-Type': 'text/plain'\n            })\n          })\n        )\n      ).then((responses) => ({\n        data: responses.map(({ json }) => json.id)\n      })),\n\n    getResources: () => {\n        \n        if(conf){\n            return Promise.resolve({data: conf});\n        };\n        return httpClient(`${apiUrl}/schema`, {\n            method: 'GET'\n        }).then(({json}) => {\n            localStorage.setItem('raconf', JSON.stringify(json));\n            return { data: json };\n        })\n        .catch(()=> {return {data : {}} })\n      }\n    \n  };\n};\n\nfunction capitalize(s: string): string {\n  return s;\n  return s[0].toUpperCase() + s.slice(1);\n}\nexport interface includeRelations {\n  resource: string;\n  includes: string[];\n}\n","import React from \"react\";\nimport { makeStyles } from '@material-ui/core/styles';\nimport DynInput from \"./DynInput.js\";\nimport {\n    SimpleForm\n  } from \"react-admin\";\n  \nimport Grid from '@material-ui/core/Grid';\n\nconst useStyles = makeStyles({\n    edit_grid : { width: \"100%\" }\n});\n\nconst AttrForm = ({attributes, ...props}) => {\n    \n    const classes = useStyles();\n    return <SimpleForm {...props}>\n                <Grid container spacing={2} margin={2} m={40} className={classes.edit_grid}>\n                {attributes.filter(attr => !attr.relationship && !attr.hidden).map((attr) => <DynInput attribute={attr} key={attr.name} xs={4}/> )}\n                </Grid>\n                <Grid container spacing={2} margin={2} m={40} className={classes.edit_grid}>\n                {\n                  attributes.filter(attr => attr.relationship && !attr.hidden)\n                            .map((attr, i) => <React.Fragment key={i}>\n                                                <DynInput attribute={attr} xs={5}/><Grid item xs={6}/>\n                                              </React.Fragment> )\n                }\n                </Grid>\n        </SimpleForm>\n}\n\nexport default AttrForm","import * as React from 'react';\r\nimport Box from '@material-ui/core/Box';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Modal from '@material-ui/core/Modal';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\n\r\nconst style = {\r\n  position: 'absolute',\r\n  top: '50%',\r\n  left: '50%',\r\n  transform: 'translate(-50%, -50%)',\r\n  width: \"75%\",\r\n  bgcolor: 'background.paper',\r\n  border: '2px solid #000',\r\n  boxShadow: 24,\r\n  p: 4,\r\n  textAlign: \"left\"\r\n};\r\n\r\nconst useStyles = makeStyles({\r\n  joined_field : {cursor: \"pointer\", color: \"#3f51b5\"}\r\n});\r\n\r\n\r\n\r\nexport default function JoinModal({label, content, resource_name}) {\r\n  const [open, setOpen] = React.useState(false);\r\n  const handleOpen = (e) => {setOpen(true); e.stopPropagation();}\r\n  const handleClose = (e) => {e.stopPropagation();setOpen(false);}\r\n  \r\n  const classes = useStyles()\r\n\r\n  return (\r\n    <span>\r\n      <span onClick={handleOpen} className={classes.joined_field} title={`${resource_name} Relationship` }>{label} </span>\r\n      <Modal\r\n        open={open}\r\n        onClose={handleClose}\r\n        aria-labelledby=\"modal-modal-title\"\r\n        aria-describedby=\"modal-modal-description\"\r\n      >\r\n        <Box sx={style}>\r\n          <Typography id=\"modal-modal-title\" variant=\"h6\" component=\"h2\">\r\n            {label}\r\n          </Typography>\r\n          <Typography id=\"modal-modal-description\" sx={{ mt: 2 }}>\r\n            {content}\r\n          </Typography>\r\n        </Box>\r\n      </Modal>\r\n    </span>\r\n  );\r\n}","import React from \"react\";\r\nimport { Typography } from '@material-ui/core';\r\nimport { useConf } from \"./Config\";\r\nimport {Pagination }  from 'react-admin'\r\nimport loadable from '@loadable/component'\r\nimport Popover from '@material-ui/core/Popover';\r\n\r\n\r\nexport const type2resource = (type, conf) => {\r\n    for(let [resource_name, resource] of Object.entries(conf?.resources)){\r\n        if(resource.type === type){\r\n            return resource_name\r\n        }\r\n    }\r\n    console.warn(`No resource for type \"${type}`)\r\n    return conf[type]\r\n};\r\n\r\n\r\nexport const DynPagination = (props) => {\r\n    return <Pagination rowsPerPageOptions={[10, 25, 50, 100]}\r\n                perPage={props.perPage || 25 }\r\n                {...props} />\r\n}\r\n\r\n\r\nexport const load_custom_component = (component_name, item) => {\r\n\r\n    try{\r\n        const LabelComponent = loadable(() => import(`./components/Custom.js`), {\r\n            resolveComponent: (components) => components[`${component_name}`],\r\n        })\r\n        return <LabelComponent instance={item} />\r\n    }\r\n    catch(e){\r\n        alert(\"Custom component error\")\r\n        console.error(\"Custom component error\", e)\r\n    }\r\n    return null\r\n}\r\n\r\n\r\nexport const InfoPopover = ({label, content}) => {\r\n    const [anchorEl, setAnchorEl] = React.useState(null);\r\n  \r\n    const handleClick = (event) => {\r\n      setAnchorEl(event.currentTarget);\r\n    };\r\n  \r\n    const handleClose = () => {\r\n      setAnchorEl(null);\r\n    };\r\n\r\n    const showInfo = (event) => {\r\n        setAnchorEl(event.currentTarget);   \r\n    }\r\n  \r\n    const open = Boolean(anchorEl);\r\n    const id = open ? 'simple-popover' : undefined;\r\n  \r\n    if(!content){\r\n        return label\r\n    }\r\n    return (\r\n      <div>\r\n        <span onClick={handleClick} onMouseOver={showInfo}>\r\n          {label}\r\n        </span>\r\n        <Popover\r\n          id={id}\r\n          open={open}\r\n          anchorEl={anchorEl}\r\n          onClose={handleClose}\r\n          anchorOrigin={{\r\n            vertical: 'top',\r\n            horizontal: 'left',\r\n          }}\r\n        >\r\n          <Typography sx={{ p: 2 }}>{content}</Typography>\r\n        </Popover>\r\n      </div>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport ReactDom from 'react-dom'\r\nimport { Typography } from '@material-ui/core';\r\nimport { Modal, Box  } from \"@material-ui/core\";\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport HelpOutlineIcon from '@mui/icons-material/HelpOutline';\r\nimport Button from '@material-ui/core/Button';\r\n\r\nconst style = {\r\n    position: 'absolute',\r\n    top: '50%',\r\n    left: '50%',\r\n    transform: 'translate(-50%, -50%)',\r\n    width: \"75%\",\r\n    bgcolor: 'background.paper',\r\n    border: '2px solid #000',\r\n    boxShadow: 24,\r\n    p: 4,\r\n    textAlign: \"left\"\r\n} \r\nconst useStyles = makeStyles({\r\n    info_modal : style,\r\n    icon : {color: '#ccc',\r\n            '&:hover' : {color: '#3f51b5'}\r\n            },\r\n});\r\n\r\n\r\nconst InfoModal = ({resource, mode}) => {\r\n    const [open, setOpen] = React.useState(false);\r\n    const handleOpen = (e) => {\r\n        setOpen(true);\r\n        e.stopPropagation(); \r\n        /*ReactDom.render(\r\n        <ReactMarkdown children={\"markdown\"} remarkPlugins={[]} />,\r\n        document.getElementById(\"info_content\"))*/\r\n    }\r\n    const handleClose = (e) => {e.stopPropagation();setOpen(false);}\r\n    const classes = useStyles()\r\n    const label = <Button label=\"Info\"><HelpOutlineIcon className={classes.icon}/></Button>\r\n    const content = resource[`info_${mode}`] // modes: \"show\", \"list\", \"edit\"\r\n    \r\n    return content ? <>\r\n        <span onClick={handleOpen} title={`${resource.name} Info`}>{label} </span>\r\n        <Modal\r\n          open={open}\r\n          onClose={handleClose}\r\n          aria-labelledby=\"modal-modal-title\"\r\n          aria-describedby=\"modal-modal-description\"\r\n        >\r\n          <Box sx={style} className={classes.info_modal}>\r\n            <Typography id=\"modal-modal-description\" sx={{ mt: 2 }}>\r\n                <div id=\"info_content\" dangerouslySetInnerHTML={{ __html: content}} />\r\n            </Typography>\r\n          </Box>\r\n        </Modal>\r\n      </> : null\r\n}\r\n\r\nexport default InfoModal","import { useState, useEffect, useMemo} from 'react';\r\nimport {\r\n    Datagrid,\r\n    EditButton\r\n} from \"react-admin\";\r\n\r\nimport Grid from '@material-ui/core/Grid';\r\nimport { Resource, TabbedShowLayout, Tab } from 'react-admin';\r\nimport {\r\n  Show,\r\n  SimpleShowLayout,\r\n  TabbedShowLayoutTabs,\r\n  ReferenceManyField,\r\n  useRecordContext,\r\n  Link\r\n} from \"react-admin\";\r\nimport { Typography } from '@material-ui/core';\r\nimport { useRefresh } from 'react-admin';\r\nimport { useDataProvider } from 'react-admin';\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport KeyboardArrowRightIcon from '@material-ui/icons/KeyboardArrowRight';\r\nimport {useConf} from '../Config.js'\r\nimport Button from '@material-ui/core/Button';\r\nimport { useQueryWithStore, Loading, Error } from 'react-admin';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { type2resource } from \"../util.js\";\r\nimport { ShowAttrField } from \"./DynFields.js\";\r\nimport { attr_fields } from \"./DynFields.js\";\r\nimport {DynPagination} from '../util'\r\nimport { ListActions as RAListActions, FilterButton, TopToolbar, CreateButton, ExportButton } from 'react-admin';\r\nimport InfoModal from \"./InfoModal.js\";\r\nimport get_Component from '../get_Component.js';\r\nimport BlockIcon from '@mui/icons-material/Block';\r\n\r\nconst useStyles = makeStyles({\r\n    join_attr: {color: '#3f51b5'},\r\n    delete_icon : {fill: \"#3f51b5\"},\r\n    edit_grid : { width: \"100%\" },\r\n    rel_icon: {paddingLeft:\"0.4rem\", color: \"#666\", marginBottom:\"0px\"},\r\n    many_tab : {color: \"#3f51b5\"},\r\n    instance_title : { margin: \"30px 0px 30px\" }\r\n});\r\n\r\n\r\nconst ResourceTitle = ({ record, resource }) => {\r\n    const key = resource?.user_key || \"id\"\r\n    if(!(record && key in record)){\r\n        return <span/>\r\n    }\r\n    return <span>{resource?.label || resource?.name || record?.type} &mdash; {record[key]}</span>\r\n};\r\n\r\nexport const DetailPanel = ({attributes}) => {\r\n    return <Grid container spacing={3} margin={5} m={40}>\r\n                {attributes.map((attr) => <ShowRecordField source={attr} key={attr.name}/> )}\r\n            </Grid>\r\n}\r\n\r\nexport const ShowRecordField = ({ source, tabs }) => {\r\n    const record = useRecordContext();\r\n    const classes = useStyles();\r\n    const attr_name = source.name\r\n    const label =  source.label || attr_name\r\n    let value = record[attr_name]\r\n    if(source.component){\r\n        const Component = get_Component(source.component)\r\n        return <Component attr={source} value={value} mode=\"show\"/>\r\n    }\r\n    return <ShowAttrField attr={source} value={value} />\r\n};\r\n\r\n\r\nconst ShowInstance = ({attributes, tab_groups, resource_name, id}) => {\r\n\r\n    const classes = useStyles()\r\n    const title = <Typography variant=\"h5\" component=\"h5\" className={classes.instance_title}>\r\n                        {resource_name}<i style={{color: \"#ccc\"}}> #{id}</i>\r\n                  </Typography>\r\n\r\n    const tabs = tab_groups?.map((tab) => {\r\n            if(tab.component){\r\n                const Component = get_Component(tab.component)\r\n                return <Tab label={tab.label || tab.name || 'InstanceTab'} key={tab.name}><Component/></Tab>\r\n            }\r\n            if(tab.direction === \"tomany\"){ // <> \"toone\"\r\n                return DynRelationshipMany(resource_name, id, tab)\r\n            }\r\n            if (tab.direction === \"toone\"){\r\n                return id !== undefined ? DynRelationshipOne(resource_name, id, tab) : null\r\n            }\r\n    })\r\n\r\n    return <SimpleShowLayout>\r\n                {title}\r\n                <Grid container spacing={3} margin={5} m={40}>\r\n                    {attributes.map((attr) => <ShowRecordField key={attr.name} source={attr} tabs={tabs}/> )}\r\n                </Grid>\r\n                <hr style={{ margin: \"30px 0px 30px\" }}/>\r\n                <TabbedShowLayout tabs={<TabbedShowLayoutTabs variant=\"scrollable\" scrollButtons=\"auto\" />}>\r\n                {tabs}\r\n                </TabbedShowLayout>\r\n            </SimpleShowLayout>\r\n}\r\n\r\n\r\nconst DynRelationshipOne = (resource, id, relationship) => {\r\n    \r\n    console.log(\"DR1\", resource, id)\r\n    const [rel_data, setRelData]  =useState(false)\r\n    const [loading, setLoading] = useState(true);\r\n    const [rel_error, setRelError] = useState(false);\r\n    const {loaded, error, data} = useQueryWithStore({\r\n        type: 'getOne',\r\n        resource: resource,\r\n        payload: { id: id }\r\n        })\r\n    const rel_id = data && relationship.fks.map(fk => data[fk] ? data[fk] : \"\").join('_')\r\n    const dataProvider = useDataProvider();\r\n    let tab_content = \" - \"\r\n    useEffect(() => {\r\n        if(rel_id === undefined || rel_id === \"\"){\r\n            setLoading(false);\r\n            return\r\n        }\r\n        dataProvider.getOne(relationship.resource, { id: rel_id })\r\n            .then(({ data }) => {\r\n                setRelData(data);\r\n                setLoading(false);\r\n            })\r\n            .catch(error => {\r\n                console.warn(error)\r\n                setRelError(error || \"Relationship Error\");\r\n                setLoading(false);\r\n            })\r\n    }, [data]);\r\n    \r\n    if (!rel_data) { \r\n        tab_content = loading ? <Loading key={relationship.name}/> : <BlockIcon style={{fill : \"#ccc\"}} title=\"No data\"/>\r\n    }\r\n    else if (error || rel_error) {\r\n        console.log({resource}, {id}, {relationship}, relationship.name)\r\n        console.log({data}, {rel_data})\r\n        tab_content = <Error key={relationship.name} error={error || rel_error}/>;\r\n    }\r\n    else if(rel_data){\r\n        tab_content = <RelatedInstance instance={rel_data} />\r\n    }\r\n    else{\r\n        // Deprecated.. Delete this stmt??\r\n        console.warn(\"Hit deprecated code!\")\r\n        if(data[relationship.name]?.data === null){\r\n            tab_content = \"Empty\"\r\n        }\r\n        else if(data && data[relationship.name]?.type && data[relationship.name].type === relationship?.target_resource?.type){\r\n            tab_content = <RelatedInstance instance={data[relationship.name]} />\r\n        }\r\n        else if(data[relationship.name]?.data){\r\n            // todo: might be obsolote, tbd\r\n            // todo: fix the data provider so we can simplify this conditional and use <RelatedInstance> instead\r\n            const rel_resource = type2resource(data[relationship.name].data?.type)\r\n            const rel_id = data[relationship.name]?.data?.id\r\n            if(!rel_resource){\r\n                console.log(data)\r\n                console.warn(`Related resource not found ${resource}.${relationship.name}`)\r\n            }\r\n            else{\r\n                tab_content = <LoadingRelatedInstance rel_resource={rel_resource} rel_id={rel_id}/>\r\n            }\r\n        }\r\n    }\r\n\r\n    return <Tab label={relationship.label || relationship.name} key={relationship.name}>\r\n                {tab_content}\r\n           </Tab>\r\n}\r\n\r\nconst LoadingRelatedInstance = ({rel_resource, rel_id}) =>{\r\n\r\n    return <div>LoadingRelatedInstance</div>\r\n    // obsolete?\r\n    /*console.log('LoadingRelatedInstance', {rel_resource}, {rel_id})\r\n    const { loaded, error, data } = useQueryWithStore({\r\n        type: 'getOne',\r\n            resource: rel_resource,\r\n            payload: { id: rel_id }\r\n    })\r\n    if (!loaded) { \r\n        return <Loading />; \r\n    }\r\n    if (error) { \r\n        return <Error />; \r\n    }\r\n    return <RelatedInstance instance={data} />*/\r\n}\r\n\r\n\r\nconst DynRelationshipMany = (resource_name, id, relationship) => {\r\n\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState();\r\n    const [related, setRelated] = useState(false);\r\n    const dataProvider = useDataProvider();\r\n    const classes = useStyles();\r\n    const conf = useConf();\r\n\r\n    useEffect(() => {\r\n        dataProvider.getOne(resource_name, { id: id })\r\n            .then(({ data }) => {\r\n                setRelated(data.relationships);\r\n                setLoading(false);\r\n            })\r\n            .catch(error => {\r\n                setError(error);\r\n                setLoading(false);\r\n            })\r\n    }, []);\r\n\r\n    const target_resource = conf.resources[relationship?.resource]\r\n    if(!target_resource){\r\n        console.warn(`${resource_name}: No resource conf for ${relationship.resource}`)\r\n        console.log({relationship})\r\n        return null\r\n    }\r\n\r\n    if(!target_resource?.attributes){\r\n        console.log(\"No target resource attributes\")\r\n        return null\r\n    }\r\n\r\n    /*\r\n        Render the datagrid, this is similar to the grid in gen_DynResourceList\r\n        todo: merge these into one component\r\n    */\r\n    let attributes = target_resource.attributes.filter(attr => attr.relationship?.target !== resource_name) // ignore relationships pointing back to the parent resource\r\n    attributes = relationship.attributes ? attributes.filter(attr => relationship.attributes.find(r_attr=> r_attr.name == attr.name)) : attributes\r\n    \r\n    const fields = attr_fields(attributes);\r\n    const col_nr = target_resource.max_list_columns\r\n    const fk = relationship.fks.join('_')\r\n    const label = relationship.label || relationship.name\r\n    \r\n    return <Tab label={label} key={relationship.name} className={classes.many_tab}>\r\n                <ReferenceManyField reference={relationship.resource} target={fk} addLabel={false} pagination={<DynPagination/>}  perPage={target_resource.perPage || 25}>\r\n                    <Datagrid rowClick=\"show\" expand={<DetailPanel attributes={target_resource.attributes} />}>\r\n                        {fields.slice(0,col_nr)}\r\n                        <EditButton />\r\n                    </Datagrid>\r\n                </ReferenceManyField>            \r\n            </Tab>\r\n}\r\n\r\n\r\nexport const RelatedInstance = ({instance}) => {\r\n\r\n    const conf = useConf();\r\n    if (!instance?.type){\r\n        return <span></span>;\r\n    }\r\n    const resource_name = type2resource(instance?.type, conf)\r\n    if (!resource_name){\r\n        return <span>...</span>;\r\n    }\r\n    \r\n    const resource_conf = conf.resources[resource_name]\r\n    const attributes = resource_conf?.attributes || [];\r\n    const relationships = resource_conf?.relationships || [];\r\n    \r\n    // ugly manual styling because adding to TabbedShowLayout didn't work\r\n    const result = <div style={{left: \"-16px\", position: \"relative\"}}> \r\n                        <div style={{textAlign:\"right\", width:\"100%\"}} >\r\n                            <Button\r\n                                title=\"edit\"\r\n                                component={Link}\r\n                                to={{\r\n                                    pathname: `${resource_name}/${instance.id}`\r\n                                    }}\r\n                                label=\"Link\"><EditIcon />Edit\r\n                            </Button>\r\n                            <Button\r\n                                title=\"view\"\r\n                                component={Link}\r\n                                to={{\r\n                                    pathname: `/${resource_name}/${instance.id}/show`\r\n                                    }}\r\n                                label=\"Link\"><KeyboardArrowRightIcon />View\r\n                            </Button>\r\n                        </div>\r\n                        <Grid container spacing={3}>\r\n                                { //{attributes.map((attr) => <ShowField label={attr.name} key={attr.name} value={instance.attributes[attr.name]}/> )}\r\n                                attributes.map((attr) => <ShowAttrField key={attr.name} attr={attr} value={instance.attributes[attr.name]}/> )\r\n                                }\r\n                        </Grid>\r\n                    </div>\r\n   \r\n    return result;\r\n}\r\n\r\nconst ShowActions = ({ basePath, data, resource}) => {\r\n    \r\n    return <TopToolbar>\r\n                <InfoModal resource={resource} mode=\"show\"/>\r\n                <EditButton basePath={basePath} record={data} />\r\n            </TopToolbar>\r\n}\r\n\r\nexport const gen_DynResourceShow = (resource_conf) => (props) => {\r\n\r\n    const attributes = resource_conf.attributes\r\n    const tab_groups= resource_conf.tab_groups\r\n    let show = <ShowInstance attributes={attributes} tab_groups={tab_groups} resource_name={props.resource} id={props.id}/>\r\n    if(resource_conf.components?.show){\r\n        const Wrapper = get_Component(resource_conf.components?.show)\r\n        show = <Wrapper show={show} />\r\n    }\r\n\r\n    return <Show title={<ResourceTitle resource={resource_conf}/>} actions={<ShowActions resource={resource_conf}/>} {...props}>\r\n                {show}\r\n            </Show>\r\n}","import React from \"react\";\r\nimport { useRefresh } from 'react-admin';\r\nimport { useDataProvider } from 'react-admin';\r\nimport { \r\n    Confirm,\r\n    useRecordContext,\r\n    DateField,\r\n    PasswordInput,\r\n    TextField,\r\n    FunctionField } from 'react-admin';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport { Typography } from '@material-ui/core';\r\nimport { useQueryWithStore, Loading, Error } from 'react-admin';\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport { useState, useEffect, useMemo} from 'react';\r\nimport Tooltip from '@mui/material/Tooltip';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport DensityMediumIcon from '@mui/icons-material/DensityMedium';\r\nimport Button from '@material-ui/core/Button';\r\nimport { useConf } from '../Config';\r\nimport JoinModal from './JoinModal'\r\nimport { load_custom_component } from '../util';\r\nimport { RelatedInstance } from \"./DynInstance\";\r\nimport loadable from '@loadable/component'\r\nimport {InfoPopover} from '../util'\r\n\r\nconst useStyles = makeStyles({\r\n    join_attr: {color: '#3f51b5;'},\r\n    delete_icon : {fill: \"#3f51b5\"},\r\n    edit_grid : { width: \"100%\" },\r\n    rel_icon: {paddingLeft:\"0.4rem\", color: \"#666\", marginBottom:\"0px\"},\r\n    joined_field : {border: \"2px solid red\", cursor: \"pointer\"}\r\n});\r\n\r\n\r\nconst RelLabel = ({text}) => {\r\n    // Relationship column header label\r\n    const classes = useStyles()\r\n\r\n    let label = <Tooltip title={text + \" Relationship\"} placement=\"top-start\" arrow>\r\n                    <span style={{ display: \"inline-flex\"}}>\r\n                            {text}\r\n                            <DensityMediumIcon \r\n                                className={classes.rel_icon} style={{width: \"0.7rem\", height: \"0.7rem\", paddingTop: \"0.5rem\"}} \r\n                            />\r\n                            \r\n                    </span>\r\n                </Tooltip>\r\n    return label\r\n}\r\n\r\n\r\nconst TruncatedTextField = (props) => {\r\n    \r\n    const record = props.record // \"record\" is a prop received from the Datagrid\r\n    const source = props.source\r\n    if(!record || !source){\r\n        return <span></span>\r\n    }\r\n    let value = record[source];\r\n    if(value && !React.isValidElement(value) && typeof value == \"object\"){\r\n        try{\r\n            console.log(`Converting value :${value}`)\r\n            value=JSON.stringify(value)\r\n        }\r\n        catch(err){\r\n            console.log(`Invalid element value :${value}`)\r\n            console.warn(err)\r\n            value = \"Value Error\"\r\n        }\r\n    }\r\n    if(!value || value.length < 128 || !value.slice || !value.slice instanceof Function){\r\n        return <span>{value}</span>\r\n    }\r\n    return <span>{value.slice(0, 128) + \"...\" }</span>;\r\n}\r\n\r\n\r\nconst NestedJoinedField = ({resource_name, id}) => {\r\n    // Nested foins no longer have access to the right RecordContext\r\n    // this doesn't work for composite keys :// (because we just pass a single id)\r\n    const conf = useConf();\r\n    const user_key = conf.resources[resource_name]?.user_key || \"id\"\r\n    const { data, loading, error } = useQueryWithStore({ \r\n        type: 'getOne',\r\n        resource: resource_name,\r\n        payload: { id: id }\r\n    });\r\n    const modal_content = <RelatedInstance instance={data} resource_name={resource_name}/>\r\n    return <JoinModal label={data && data[user_key]} content={modal_content} resource_name={resource_name} />\r\n}\r\n\r\nconst JoinedField = ({attribute, pvalue}) => {\r\n    \r\n    const join = attribute.relationship\r\n    const record = useRecordContext();\r\n    if(record?.attributes){\r\n        Object.assign(record, record.attributes)\r\n    }\r\n    const rel_name = join.name;\r\n    const target_resource = join.target_resource\r\n    const user_key = target_resource?.user_key\r\n    const user_component = target_resource?.user_component\r\n    const fk = join.fks.join('_')\r\n    const id = record ? record[fk] : null\r\n    \r\n    const { data, loading, error } = useQueryWithStore({ \r\n        type: 'getOne',\r\n        resource: target_resource.name,\r\n        payload: { id: id }\r\n    })\r\n\r\n    if(!record){\r\n        return null\r\n    }\r\n\r\n    if(loading){\r\n        return <span>{id}</span>\r\n    }\r\n    \r\n    let item = data || record[rel_name]\r\n    let label = item?.id || id\r\n    \r\n    if(!item){\r\n        // no item: if there is data then we're in a nested view and pvalue already holds our id\r\n        // without data this join is empty\r\n        return data ? <NestedJoinedField resource_name={target_resource.name} id={pvalue} /> : null\r\n    }\r\n    if(user_component){\r\n        // user_component: custom component\r\n        label = load_custom_component(user_component, item)\r\n    }\r\n    else if(item.attributes && user_key){\r\n        const target_col = attribute.relationship.target_resource.attributes.filter((col) => col.name == user_key)\r\n        label = <span>{item.attributes[user_key] || item.id}</span>\r\n    }\r\n    else if (user_key in item){\r\n        label = item[user_key]\r\n        item.type = target_resource?.type\r\n        item.attributes = item\r\n    }\r\n    if(!label){\r\n        label = 'NNN'\r\n    }\r\n    const modal_content = <RelatedInstance instance={item} resource_name={target_resource.name}/>\r\n    return <JoinModal label={label} key={attribute.name} content={modal_content} resource_name={target_resource.name} />\r\n}\r\n\r\n\r\nconst ToOneJoin = ({attribute}) => {\r\n    const record = useRecordContext();\r\n    const label_text = attribute.label || attribute.relationship.resource || attribute.name\r\n    const label = <RelLabel text={label_text} />\r\n    return <JoinedField key={attribute.name} attribute={attribute} label={label} pvalue={record.id}/>\r\n}\r\n\r\nexport const attr_fields = (attributes, mode, ...props) => {\r\n\r\n    if(! attributes instanceof Array){\r\n        console.warn(\"Invalid attributes\", attributes)\r\n        return []\r\n    }\r\n    \r\n    const fields = attributes.map((attr) => {\r\n            if(attr.hidden === mode || attr.hidden === true){\r\n                //return null;\r\n            }\r\n            if(attr.relationship?.direction == \"toone\"){\r\n                const label_text = attr.label || attr.relationship.resource || attr.name\r\n                return <ToOneJoin attribute={attr} label={label_text} key={attr.name}/>\r\n            }\r\n            return AttrField({attribute: attr, mode: mode, ...props})\r\n        }\r\n    )//.filter((attr) => attr?.key) // filter out \"null\" items, for ex when it's not supposed to show up in this mode\r\n    \r\n    return fields\r\n}\r\n\r\n\r\nconst AttrField = ({attribute, mode, ...props}) => {\r\n    /* Attribute fields\r\n        Return a component that will be filled in depending on the record context\r\n    */\r\n    const component = attribute.component // component name to be loaded\r\n    const style = attribute.style || {}\r\n    /*if(attribute.hidden === mode || attribute.hidden === true){\r\n        return null\r\n    }*/\r\n    \r\n    const conf = useConf();\r\n    let result = <TruncatedTextField source={attribute.name} key={attribute.name} sortBy={attribute.name} label={attribute.label || attribute.name} {...props}/>\r\n    \r\n    if(attribute.type?.toLowerCase() == \"date\"){\r\n        result = <DateField source={attribute.name} key={attribute.name} style={style} locales={conf.settings.locale} {...props}/>\r\n    }\r\n    if(!component){\r\n        return result\r\n    }\r\n    \r\n    // component is specified => render the specified component\r\n    try{\r\n        const Component = loadable(() => import(`./Custom.js`), {\r\n                resolveComponent: (components) => components[component],\r\n        })\r\n        const label_text = attribute.label || attribute.name\r\n        result = <Component attribute={attribute} mode={mode} label={label_text}/>\r\n    }\r\n    catch(e){\r\n        alert(\"Custom component error\")\r\n        console.error(\"Custom component error\", e)\r\n    }\r\n    return result\r\n}\r\n\r\n\r\nconst ShowField = ({ label, value, attr, mode, ...props }) => {\r\n    // Field like it is shown in the instance /show\r\n\r\n    const trunc_size = Number(attr.trunc_size) || 1024\r\n    const [full_text, setFullText] = useState(false)\r\n    const style = {}\r\n    let shown = value\r\n    let component = attr.component || \"p\"\r\n    if(value && !React.isValidElement(value) && typeof value == \"object\"){\r\n        try{\r\n            console.log(`Converting value :${value}`)\r\n            shown=JSON.stringify(value, null, 2)\r\n            component = \"pre\"\r\n            style[\"width\"] = \"40%\"\r\n        }\r\n        catch(err){\r\n            console.log(`Invalid element value :${value}`)\r\n            console.warn(err)\r\n            shown = <i>Value Error</i>\r\n        }\r\n    }\r\n    \r\n    if(!value || value.length < trunc_size || !value.slice || !value.slice instanceof Function){\r\n        \r\n    }\r\n    else{\r\n        shown = <>{value.slice(0, trunc_size)}<br/><Button outlined color=\"primary\" onClick={()=>setFullText(value)}>More...</Button></>\r\n        component = \"pre\"\r\n    }\r\n    \r\n    return (\r\n      <Grid item xs={3}>\r\n        <Typography variant=\"body2\" color=\"textSecondary\" component=\"p\">\r\n          {label}\r\n        </Typography>\r\n        <Typography variant=\"body2\" component={component} style={style}>\r\n          {full_text || shown}\r\n        </Typography>\r\n      </Grid>\r\n    )\r\n};\r\n\r\n\r\nexport const ShowAttrField = ({attr, value}) => {\r\n    const attr_name = attr.name\r\n    const classes = useStyles();\r\n    let label =  <InfoPopover label={attr.label || attr_name} content={attr.info}/>\r\n    let field_props = {\r\n        //label : label, \r\n        //value: value,\r\n        attr: attr, \r\n        mode: \"show\"\r\n    }\r\n    if(attr.relationship){\r\n        // todo: make the onClick handler open the corresponding tab\r\n        const jf = <JoinedField key={attr.name} attribute={attr} pvalue={value} />\r\n        const rel_label = <span style={{ display: \"inline-flex\"}}>\r\n                                {attr.name} / {label}\r\n                                <DensityMediumIcon \r\n                                    className={classes.rel_icon} style={{width: \"0.7rem\", height: \"0.7rem\", paddingTop: \"0.3rem\"}}\r\n                                />\r\n                    </span>\r\n        field_props[label] = \"rel_label\"\r\n        field_props[value] = 'jf'\r\n        label = rel_label\r\n        value = value || value === 0 ? <>{value} / {jf}</> : <></>\r\n    }\r\n    return <ShowField {...field_props} value={value} label={label}/>\r\n}\r\n","import React from \"react\";\r\nimport { Typography } from '@material-ui/core';\r\nimport { \r\n    Datagrid,\r\n    TextField,\r\n    DateField,\r\n    EditButton,\r\n    ShowButton,\r\n    List,\r\n    TextInput,\r\n    useDataProvider,\r\n    useRefresh,\r\n    useRecordContext,\r\n    Confirm,\r\n    FunctionField\r\n} from \"react-admin\";\r\nimport Button from '@material-ui/core/Button';\r\nimport { useState, useEffect, useMemo} from 'react';\r\nimport { attr_fields } from \"./DynFields.js\";\r\nimport { DynPagination } from \"../util.js\";\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport { DetailPanel } from \"./DynInstance.js\";\r\nimport { ListActions as RAListActions, FilterButton, TopToolbar, CreateButton, ExportButton } from 'react-admin';\r\nimport InfoModal from \"./InfoModal.js\";\r\nimport get_Component from '../get_Component.js';\r\n\r\nconst useStyles = makeStyles({\r\n    icon : {color: '#ccc',\r\n            '&:hover' : {color: '#3f51b5'}\r\n            },\r\n    delete_icon : {color: '#3f51b5'}\r\n});\r\n\r\nconst searchFilters = [\r\n    <TextInput source=\"q\" label=\"Search\" alwaysOn />\r\n];\r\n\r\nconst deleteField = (dataProvider, resource, record, refresh) => {\r\n    /*\r\n        resource: name of the resource\r\n    */\r\n    dataProvider.delete(resource, record)\r\n        .then(()=>refresh())\r\n        .catch((e)=> alert('error'))\r\n}\r\n\r\n\r\nconst DeleteButton = (props) => {\r\n\r\n    const [open, setOpen] = useState(false);\r\n    const dataProvider = useDataProvider();\r\n    const refresh = useRefresh();\r\n    const record = useRecordContext();\r\n    const classes = useStyles();\r\n    \r\n    return <span>\r\n            <FunctionField title=\"Delete\"\r\n                onClick={(e)=> {setOpen(true); e.stopPropagation()}}\r\n                key={`${props.resource.name}_delete`}\r\n                render={record => <Button> \r\n                                    <DeleteIcon className={classes.delete_icon} />\r\n                                </Button>}\r\n                {...props} />\r\n            <Confirm\r\n                    isOpen={open}\r\n                    title={`Delete \"${props.resource}, id ${record.id}\"`}\r\n                    content={`Are you sure you want to delete this record?`}\r\n                    onConfirm={() => {deleteField(dataProvider, props.resource, record, refresh);setOpen(false)}}\r\n                    onClose={()=>{setOpen(false);}}\r\n                />\r\n            </span>\r\n}\r\n\r\n\r\nconst ListActions = ({resource}) => {\r\n    \r\n    \r\n    return <TopToolbar>\r\n                <FilterButton/>\r\n                <InfoModal resource={resource} mode=\"list\"/>\r\n                <CreateButton/>\r\n                <ExportButton/>                \r\n            </TopToolbar>\r\n}\r\n\r\n\r\nconst gen_DynResourceList = (resource_conf) => (props) => {\r\n\r\n    const ButtonField = (props) => {\r\n        let filtered_props = {}\r\n        for(let [k, v] of Object.entries(props)){\r\n            //filtered_props[k] = v\r\n            // filter \"hasCreate\" etc, this causes console warnings\r\n            //if(! k.startsWith('has') && ! k == \"syncWithLocation\"){\r\n            if(! k.startsWith('has')){\r\n                filtered_props[k] = v\r\n            }\r\n        }\r\n        const buttons = <span>\r\n                {resource_conf.edit !== false ? <EditButton title=\"Edit\" key={`${resource_conf.name}_edit`} label={\"\"} {...filtered_props} /> : null}\r\n                {resource_conf.delete !== false ? <DeleteButton {...filtered_props} /> : null}\r\n                <ShowButton title=\"Show\" label=\"\" {...filtered_props} />\r\n            </span>\r\n        return buttons\r\n    }\r\n\r\n    const ListTitle = (props) => <>{resource_conf.name} List</>\r\n    const attributes = resource_conf.attributes\r\n    const fields = attr_fields(attributes, \"list\");\r\n    const col_nr = resource_conf.max_list_columns\r\n    const sort = resource_conf.sort_attr_names ? resource_conf.sort_attr_names[0] : \"\"\r\n    \r\n    document.title = resource_conf.label || resource_conf.name\r\n    \r\n    let list = <List filters={searchFilters} perPage={resource_conf.perPage || 25}\r\n                actions={<ListActions resource={resource_conf}/>}\r\n                pagination={<DynPagination/>}\r\n                sort={{field: sort, order: 'ASC'}}\r\n                title={<ListTitle/>}\r\n                {...props} >\r\n                <Datagrid rowClick=\"show\" expand={<DetailPanel attributes={attributes} />}>\r\n                    {fields.slice(0, col_nr)}\r\n                    <ButtonField resource={resource_conf} {...props} />\r\n                </Datagrid>\r\n            </List>\r\n    \r\n    if(resource_conf.components?.list){\r\n        const Wrapper = get_Component(resource_conf.components?.list)\r\n        list = <Wrapper list={list} />\r\n    }\r\n\r\n    return list\r\n}\r\n\r\nexport default gen_DynResourceList","import React from \"react\";\nimport { useState, useMemo} from 'react';\nimport { Resource} from 'react-admin';\nimport {\n  Edit\n} from \"react-admin\";\nimport { useRefresh } from 'react-admin';\nimport { useDataProvider } from 'react-admin';\nimport { useNotify, useRedirect } from 'react-admin';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useHistory } from \"react-router-dom\";\nimport AttrForm from \"./AttrForm.js\";\n\nconst useStyles = makeStyles({\n    join_attr: {color: '#3f51b5;'},\n    delete_icon : {fill: \"#3f51b5\"},\n    edit_grid : { width: \"100%\" },\n    rel_icon: {paddingLeft:\"0.4rem\", color: \"#666\", marginBottom:\"0px\"}\n});\n\nconst DynEdit = (props) => {\n\n\n    return <Edit {...props}>\n                <AttrForm attributes={props.attributes} />\n            </Edit>\n}\n\nexport const gen_DynResourceEdit = (resource) => {\n    \n    const attributes = resource.attributes;\n    \n    const Result = (props) => {\n        \n        const notify = useNotify();\n        const refresh = useRefresh();\n        const redirect = useRedirect();\n        const dataProvider = useDataProvider();\n        const classes = useStyles();\n        const history = useHistory();\n        const [loaded, setLoaded] = useState(false)\n\n        const onFailure = (error) => {\n            notify(`Error Saving Changes`,  { type: 'warning' })\n            redirect('edit', props.basePath, props.id);\n            refresh();\n        }\n\n        const onSuccess = () => {\n            notify(`Changes Saved`);\n            history.goBack()\n            refresh();\n        }\n        \n        refresh()\n\n        return <DynEdit {...props} attributes={attributes} onFailure={onFailure} onSuccess={onSuccess}  mutationMode=\"pessimistic\" />\n        \n    }\n    return Result;\n}\n","import React from \"react\";\nimport { useState, useMemo} from 'react';\nimport { Resource} from 'react-admin';\nimport {\n  Edit,\n  Create\n} from \"react-admin\";\nimport { useRefresh } from 'react-admin';\nimport { useDataProvider } from 'react-admin';\nimport {useConf} from './Config.js'\nimport './style/DynStyle.css'\nimport { useNotify, useRedirect } from 'react-admin';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useHistory } from \"react-router-dom\";\nimport AttrForm from \"./components/AttrForm.js\";\nimport gen_DynResourceList from './components/DynList'\nimport { gen_DynResourceShow } from './components/DynInstance'\nimport get_Component from \"./get_Component\";\nimport {gen_DynResourceEdit} from './components/DynResourceEdit'\n//import {ExtComp} from './components/ExtComp';\n\nconst useStyles = makeStyles({\n    join_attr: {color: '#3f51b5;'},\n    delete_icon : {fill: \"#3f51b5\"},\n    edit_grid : { width: \"100%\" },\n    rel_icon: {paddingLeft:\"0.4rem\", color: \"#666\", marginBottom:\"0px\"}\n});\n\n\nexport const gen_DynResourceCreate = (resource) => (props) => {\n\n    const refresh = useRefresh();\n    const history = useHistory();\n    const notify = useNotify();\n    const attributes = resource.attributes\n\n    if(resource.create){\n        const CreateComp = get_Component(resource.create)\n        console.log({resource})\n        return <CreateComp resource_name={resource.name} {...props}></CreateComp>\n    }\n\n    const onSuccess = () => {\n        notify(`Changes Saved`);\n        history.goBack()\n        refresh();\n    }\n\n    return <Create {...props} onSuccess={onSuccess}>\n                <AttrForm attributes={attributes} />\n            </Create >\n};\n\n\n\nexport const DynResource = (props) => {\n    const conf = useConf();\n    window.addEventListener(\"storage\", ()=>window.location.reload())\n    const [, updateState] = React.useState();\n    const [resource_conf, setConf] = useState(conf.resources[props.name])\n    const List= useMemo(()=> gen_DynResourceList(resource_conf), [resource_conf])\n    const Create = useMemo(()=> gen_DynResourceCreate(resource_conf), [resource_conf])\n    const Edit = useMemo(()=> gen_DynResourceEdit(resource_conf), [resource_conf])\n    const Show = useMemo(()=> gen_DynResourceShow(resource_conf), [resource_conf])\n    let options = {}\n    if(resource_conf.label && resource_conf.label != resource_conf.name){\n        //adding a label works, but causes a full rerender of the component which may not be desirable\n        options={label: resource_conf.label}\n        return <Resource key={props.name} list={List} edit={Edit} create={Create} show={Show} options={options} {...props}/>\n    }\n    return <Resource key={props.name} list={List} edit={Edit} create={Create} show={Show} {...props}/>\n}\n\n","import * as React from 'react';\r\nimport { Suspense, useMemo } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { useRef, Component } from 'react'\r\nimport { TextareaAutosize, TextField } from '@material-ui/core';\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport Button from '@material-ui/core/Button';\r\nimport { useState, useEffect } from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport ClearIcon from \"@material-ui/icons/Clear\";\r\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\r\nimport {default_configs} from \"../Config\"\r\nimport { TabbedShowLayout, Tab } from 'react-admin';\r\nimport Box from '@mui/material/Box';\r\nimport InputLabel from '@mui/material/InputLabel';\r\nimport MenuItem from '@mui/material/MenuItem';\r\nimport FormControl from '@mui/material/FormControl';\r\nimport Select from '@mui/material/Select';\r\nimport Modal from '@material-ui/core/Modal';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport {useNotify } from 'react-admin';\r\nimport {Loading } from 'react-admin';\r\n\r\nconst yaml = require('js-yaml')\r\n\r\nlet als_yaml_url = \"/ui/admin/admin.yaml\"\r\nif(window.location.href.includes(\":3000\")){\r\n    als_yaml_url = \"http://localhost:5656/ui/admin/admin.yaml\"\r\n}\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    widget : {\r\n        border: \"1px solid #3f51b5\",\r\n        marginRight: \"1em\",\r\n        marginTop : \"1em\",\r\n        marginBottom : \"1em\"\r\n    },\r\n    textInput : {\r\n        width : \"80%\"\r\n    },\r\n    modal : {\r\n        position: 'absolute',\r\n        top: '15%',\r\n        left: '50%',\r\n        transform: 'translate(-50%, -50%)',\r\n        width: \"75%\",\r\n        bgcolor: 'background.paper',\r\n        border: '2px solid #000',\r\n        boxShadow: 24,\r\n        p: 4,\r\n        textAlign: \"left\"\r\n    }\r\n}));\r\n\r\n\r\nconst DeleteConf = (conf_name) => {\r\n    if(! window.confirm(`Delete configuration \"${conf_name}\" ?`)){\r\n        return\r\n    }\r\n\r\n    try{\r\n        let configs = JSON.parse(localStorage.getItem(\"raconfigs\",\"{}\"))\r\n        delete configs[conf_name]\r\n        localStorage.setItem(\"raconfigs\",JSON.stringify(configs))\r\n        window.location.reload()\r\n    }\r\n    catch(e){\r\n        alert(\"Localstorage error\")\r\n    }\r\n    \r\n}\r\n\r\n\r\nconst addConf = (conf) => {\r\n    console.log(conf)\r\n    const configs = JSON.parse(localStorage.getItem(\"raconfigs\"));\r\n    if(!conf.api_root){\r\n        console.warn(\"Config has no api_root\", conf);\r\n        return false\r\n    }\r\n    configs[conf.api_root] = conf\r\n    localStorage.setItem(\"raconf\", JSON.stringify(conf));\r\n    localStorage.setItem(\"raconfigs\", JSON.stringify(configs));\r\n    window.location.reload();\r\n    return true\r\n}\r\n\r\n\r\nexport const LoadYaml = (config_url, notify) => {\r\n    \r\n    if(config_url == null){\r\n        config_url = als_yaml_url\r\n    }\r\n    \r\n    const saveConf = (conf_str) => {\r\n        // first try to parse as json, if this doesn't work, try yaml\r\n        try{\r\n            const conf = JSON.parse(conf_str)\r\n            if(typeof r !== 'object'){\r\n                saveYaml(conf_str)\r\n                return\r\n            }\r\n            if( ! addConf(conf) && notify){\r\n                notify('Failed to load config', 'warning')\r\n            }\r\n        }\r\n        catch(e){\r\n            saveYaml(conf_str)\r\n        }\r\n    }\r\n\r\n    const saveYaml = (ystr) => {\r\n        \r\n        try{\r\n            const conf = yaml.load(ystr)\r\n            if( ! addConf(conf) && notify){\r\n                notify('Failed to load config', 'warning')\r\n            }\r\n        }\r\n        catch(e){\r\n            console.warn(`Failed to load yaml`, ystr)\r\n            console.error(e)\r\n        }\r\n    }\r\n\r\n    fetch(config_url, {cache: \"no-store\"})\r\n        .then((response) => response.text())\r\n        .then((conf_str) => {\r\n            saveConf(conf_str)\r\n            notify(\"Loaded configuration\")\r\n        })\r\n        .catch((err)=>{\r\n                if(notify){\r\n                        notify(\"Failed to load yaml\", { type : 'warning' })\r\n                }\r\n                console.error(`Failed to load yaml from ${config_url}: ${err}`)\r\n        })\r\n    \r\n}\r\n\r\n\r\nconst ManageModal = () => {\r\n    const [open, setOpen] = React.useState(false);\r\n    const handleOpen = (e) => {setOpen(true);}\r\n    const handleClose = (e) => {setOpen(false);}\r\n\r\n    let configs = []\r\n    \r\n    try{\r\n        configs = JSON.parse(localStorage.getItem(\"raconfigs\",\"{}\"))\r\n    }\r\n    catch(e){\r\n        alert(\"Localstorage error\")\r\n    }\r\n\r\n    const classes = useStyles();\r\n    const modal_style =  {\r\n        position: 'absolute',\r\n        top: '25%',\r\n        left: '50%',\r\n        transform: 'translate(-50%, -50%)',\r\n        width: \"75%\",\r\n        bgcolor: 'background.paper',\r\n        border: '2px solid #000',\r\n        boxShadow: 24,\r\n        p: 4,\r\n        textAlign: \"left\"\r\n    }\r\n\r\n    const config_list = configs ? Object.entries(configs).map(([name, conf]) => <li key={name}>{name} <ClearIcon key={name} onClick={()=>DeleteConf(name)}/></li> ) : <span/>\r\n    const textFieldRef = useRef();\r\n    const notify = useNotify();\r\n    return [\r\n        <Button className={classes.widget} onClick={()=> handleOpen()} color=\"primary\" >Manage</Button>,\r\n        <Modal\r\n            open={open}\r\n            onClose={handleClose}\r\n            aria-labelledby=\"modal-modal-title\"\r\n            aria-describedby=\"modal-modal-description\">\r\n            <Box sx={modal_style}>\r\n                <Typography id=\"modal-modal-title\" variant=\"h6\" component=\"h2\">\r\n                    Manage Configurations\r\n                </Typography>\r\n                <Typography id=\"modal-modal-description\" sx={{ mt: 2 }}>\r\n                    <ul>\r\n                        {config_list}\r\n                    </ul>\r\n                </Typography>\r\n                \r\n                <Typography id=\"modal-modal-title\" variant=\"h6\" component=\"h2\">\r\n                    Load Configuration from URL\r\n                </Typography>\r\n                <Typography id=\"modal-modal-description\" sx={{ mt: 2 }}>\r\n                    <TextField label=\"Config URL\" style={{ margin: 16, width: \"100%\" }} inputRef={textFieldRef}/>\r\n                    <Button className={classes.widget} onClick={(evt)=> LoadYaml(textFieldRef.current.value, notify) } color=\"primary\" >Load</Button>\r\n                </Typography>\r\n            </Box>\r\n        </Modal>\r\n    ]\r\n}\r\n\r\n\r\nconst ConfSelect = () => {\r\n    let configs = []\r\n    \r\n    try{\r\n        configs = JSON.parse(localStorage.getItem(\"raconfigs\",\"{}\"))\r\n    }\r\n    catch(e){\r\n        alert(\"Localstorage error\")\r\n    }\r\n    const current_conf = JSON.parse(localStorage.getItem(\"raconf\",\"\"))\r\n    const [current, setCurrent] = React.useState(current_conf.api_root);\r\n  \r\n    const handleChange = (event) => {\r\n      setCurrent(event.target.value);\r\n      const new_conf = configs[event.target.value]\r\n      if(!new_conf){\r\n          return\r\n      }\r\n      localStorage.setItem(\"raconf\", JSON.stringify(new_conf));\r\n      window.location.reload()\r\n    };\r\n      \r\n    return (\r\n      <Box sx={{ minWidth: 120 }}>\r\n        <FormControl fullWidth>\r\n          <InputLabel id=\"demo-simple-select-label\">Saved Configurations</InputLabel>\r\n          <Select\r\n            labelId=\"demo-simple-select-label\"\r\n            id=\"demo-simple-select\"\r\n            value={current}\r\n            label=\"Configs\"\r\n            size=\"small\"\r\n            onChange={handleChange}\r\n            defaultValue={current}\r\n          >\r\n            {\r\n                configs ? Object.entries(configs).map(([name, config]) => <MenuItem value={name} key={name}>{name}</MenuItem>) : null\r\n            }\r\n          </Select>\r\n        </FormControl>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n\r\nconst saveConfig = () => {\r\n    /*\r\n    Save the current config in raconf to raconfigs\r\n    */\r\n    let current_conf = JSON.parse(localStorage.getItem(\"raconf\"))\r\n    const api_root = current_conf.api_root\r\n    if(!api_root){\r\n        alert(\"Can't save: no 'api_root' set in config\")\r\n        //console.log(current_conf)\r\n        return\r\n    }\r\n    let configs = JSON.parse(localStorage.getItem(\"raconfigs\",\"{}\"))\r\n    if(!configs){\r\n        configs = {}\r\n    }\r\n    configs[api_root] = current_conf\r\n    localStorage.setItem(\"raconfigs\", JSON.stringify(configs));\r\n    window.location.reload()\r\n}\r\n\r\nexport const resetConf = (notify) => {\r\n    \r\n    const configs = {}\r\n    let defconf = {}\r\n    \r\n    for(defconf of default_configs){\r\n        localStorage.setItem(\"raconf\", JSON.stringify(defconf));\r\n        configs[defconf.api_root] = defconf\r\n    }\r\n    localStorage.setItem(\"raconf\", JSON.stringify({}));\r\n    localStorage.setItem(\"raconfigs\", JSON.stringify(configs));\r\n    LoadYaml(als_yaml_url, notify)\r\n    return defconf\r\n}\r\n\r\nconst ConfigurationUI = () => {\r\n\r\n    const classes = useStyles();\r\n    const notify = useNotify();\r\n\r\n    const saveYaml = (ystr, ev) => {\r\n        try{\r\n            const jj = yaml.load(ystr)\r\n            saveEdit(JSON.stringify(jj))\r\n            setBgColor(\"black\");\r\n        }\r\n        catch(e){\r\n            console.warn(`Failed to process`, ystr)\r\n            //notify(`${e}`, { type: \"warning\"})\r\n            setBgColor(\"red\");\r\n        }\r\n    }\r\n\r\n    const saveEdit = (text) => {\r\n        try{\r\n            if(text){\r\n                const parsed_conf = JSON.parse(text);\r\n                setApiroot(parsed_conf.api_root);\r\n            }\r\n            setBgColor(\"#ddeedd\");\r\n            //localStorage.setItem(\"raconf\", JSON.stringify(text, null, 4));\r\n            localStorage.setItem(\"raconf\", text);\r\n            if(!taConf){\r\n                window.location.reload();\r\n            }\r\n        }catch (e){\r\n            //setBgColor(\"#eedddd\");\r\n            setBgColor(\"red\");\r\n        }\r\n        setTaConf(text)\r\n    }\r\n\r\n    let conf = localStorage.getItem(\"raconf\") ||  JSON.stringify(resetConf())\r\n    const [taConf, setTaConf] = useState(conf ? JSON.stringify(JSON.parse(conf), null, 4) : \"\");\r\n    const [bgColor, setBgColor] = useState(\"black\");\r\n    const [autosave, setAutosave] = useState(true);\r\n    const [api_root, setApiroot] = useState(JSON.parse(conf)?.api_root);\r\n    const [editor, setEditor] = useState(false)\r\n\r\n    const handleAutoSaveChange = (event) => {\r\n        setAutosave(event.target.checked);\r\n    };\r\n\r\n    const Editor = useMemo(()=> React.lazy(() => import('@uiw/react-monacoeditor')), [\"monaco\"])\r\n    \r\n    return <div>\r\n                <div>\r\n                    <ConfSelect/>\r\n                    <ManageModal/>\r\n                    <Button className={classes.widget} onClick={()=> saveEdit(\"{}\")} color=\"primary\" >Clear</Button>\r\n                    <Button className={classes.widget} onClick={()=> resetConf(notify)} color=\"primary\" >Reset</Button>\r\n                    <Button className={classes.widget} onClick={()=> window.location.reload()} color=\"primary\" >Apply</Button>\r\n                    <Button className={classes.widget} onClick={()=> saveConfig()} color=\"primary\" >Save</Button>\r\n                    <FormControlLabel\r\n                        control={<Checkbox checked={autosave} onChange={handleAutoSaveChange} />}\r\n                        label=\"Auto Save Config\"\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <TabbedShowLayout>\r\n                        <Tab label=\"yaml\">\r\n                            <Suspense fallback={<Loading/>}>\r\n                                <Editor\r\n                                    language=\"yaml\"\r\n                                    value={yaml.dump(JSON.parse(taConf))}\r\n                                    options={{\r\n                                        theme: 'vs-dark',\r\n                                    }}\r\n                                    height=\"1000px\"\r\n                                    style = {{ borderLeft: `8px solid ${bgColor}`}}\r\n                                    onChange={(ystr, ev) => saveYaml(ystr, ev)}\r\n                                />\r\n                            </Suspense>\r\n                        </Tab>\r\n                        <Tab label=\"json\">\r\n                        <TextareaAutosize\r\n                                variant=\"outlined\"\r\n                                minRows={3}\r\n                                style={{ width: \"80%\", backgroundColor : \"white\" }}\r\n                                value= {JSON.stringify(JSON.parse(taConf), null, 4) }\r\n                                onChange={(evt)=>saveEdit(evt.target.value)}\r\n                            />\r\n                        </Tab>\r\n\r\n                    </TabbedShowLayout>\r\n                </div>\r\n            </div>\r\n}\r\n\r\nexport default ConfigurationUI","import * as React from 'react';\nimport { styled } from '@mui/material/styles';\nimport ArrowForwardIosSharpIcon from '@mui/icons-material/ArrowForwardIosSharp';\nimport MuiAccordion from '@mui/material/Accordion';\nimport MuiAccordionSummary from '@mui/material/AccordionSummary';\nimport MuiAccordionDetails from '@mui/material/AccordionDetails';\nimport Typography from '@mui/material/Typography';\nimport { typography } from '@material-ui/system';\n\nconst Accordion = styled((props) => (\n  <MuiAccordion disableGutters elevation={0} square {...props} />\n))(({ theme }) => ({\n  border: `1px solid ${theme.palette.divider}`,\n  '&:not(:last-child)': {\n    borderBottom: 0,\n  },\n  '&:before': {\n    display: 'none',\n  },\n}));\n\nconst AccordionSummary = styled((props) => (\n  <MuiAccordionSummary\n    expandIcon={<ArrowForwardIosSharpIcon sx={{ fontSize: '0.9rem' }} />}\n    {...props}\n  />\n))(({ theme }) => ({\n  backgroundColor:\n    theme.palette.mode === 'dark'\n      ? 'rgba(255, 255, 255, .05)'\n      : 'rgba(0, 0, 0, .03)',\n  flexDirection: 'row-reverse',\n  '& .MuiAccordionSummary-expandIconWrapper.Mui-expanded': {\n    transform: 'rotate(90deg)',\n  },\n  '& .MuiAccordionSummary-content': {\n    marginLeft: theme.spacing(1),\n  },\n}));\n\nconst AccordionDetails = styled(MuiAccordionDetails)(({ theme }) => ({\n  padding: theme.spacing(2),\n  borderTop: '1px solid rgba(0, 0, 0, .125)',\n}));\n\nexport default function CustomizedAccordions() {\n  const [expanded, setExpanded] = React.useState('panel1');\n  const handleChange = (panel) => (event, newExpanded) => {\n    setExpanded(newExpanded ? panel : false);\n  };\n  return (\n    <div>\n      <div className=\"MuiTypography-root jss4\">\n      <Typography variant=\"h4\" align=\"center\">Welcome to API Logic Server -- Sample System</Typography>\n      <Typography lineHeight = {2}><br></br><a   rel=\"nofollow\" href=\"https://github.com/valhuber/ApiLogicServer/blob/main/README.md/\" target=\"_blank\">API Logic Server</a>\n      &nbsp;creates <i>customizable</i> model-driven systems, instantly from your&nbsp;\n      <a  href=\"https://github.com/valhuber/ApiLogicServer/wiki/Sample-Database\" target=\"_blank\">database</a>.\n      <Typography><br></br></Typography>\n      </Typography>\n      <Accordion  >\n        <AccordionSummary aria-controls=\"panel1d-content\" id=\"panel1d-header\">\n          <Typography>This app was not coded - it was <i>created.</i> Click here to see how:</Typography>\n        </AccordionSummary>\n        <AccordionDetails>\n          <Typography>\n          <ul>\n            <li><i>Automated: </i>create executable systems with this single command...\n              <pre>\n              &nbsp;&nbsp;&nbsp;ApiLogicServer <strong>create-and-run</strong> \\<br></br>\n              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--project_name=ApiLogicProject \\  # customize with Python and your IDE<br></br>\n              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--db_url=sqlite:///nw.sqlite      # your db here\n              </pre>\n              </li>\n            <li><i>Model-driven: </i>creation builds executable&nbsp;\n            <a rel=\"nofollow\" href=\"https://github.com/valhuber/ApiLogicServer/wiki/Architecture#customizable-declarative-models\" target=\"_blank\">models</a>\n              , not code\n                <ul>\n                    <li>\n                    Dramatically simpler to understand, customize and maintain\n                    </li>\n                </ul>\n              <Typography>&nbsp;</Typography></li>\n            <li><i>Customizable: </i>models are created into a project;&nbsp;\n              <a rel=\"nofollow\" href=\"https://github.com/valhuber/ApiLogicServer/wiki#customizing-apilogicprojects\" target=\"_blank\">customize</a>\n              &nbsp;with Python and your IDE \n              <ul>\n                  <li>This system has about 20 rules, and 20 lines of code</li>\n              </ul>\n            </li>\n          </ul>\n          </Typography>\n        </AccordionDetails>\n      </Accordion>\n      <Typography><br></br>\n      1.&nbsp;\n          <a href=\"https://github.com/valhuber/ApiLogicServer/wiki/Admin-Tour/\" target=\"_blank\">Automatic Admin App</a>\n          &nbsp;, you are running it now\n      <ul>\n         <li>For instant collaboration and Back Office data maintenance</li>\n         <li>Rich functionality: multi-page, multi-table, automatic joins</li>\n         <li>Explore this app (e.g., click Customer, at left, and look for the info icons, upper right),\n              and how to <a  rel=\"nofollow\" href=\"https://github.com/valhuber/ApiLogicServer/wiki/Working-with-the-Admin-App\" target=\"_blank\">customize it</a></li>\n      </ul>\n      2. <a href=\"/api\" target=\"_blank\">API</a>, with oas/Swagger\n      <ul>\n         <li>For custom app dev, application integration</li>\n         <li>Rich functionality: endpoint for each table, with filtering, pagination, related data</li>\n         <li><a rel=\"nofollow\" href=\"https://github.com/valhuber/ApiLogicServer/wiki#customize-the-api-with-expose_servicespy-add-rpcs-services\" target=\"_blank\">Customizable</a>: add your own endpoints</li>\n      </ul>\n      3.&nbsp;\n      <a  rel=\"nofollow\" href=\"https://github.com/valhuber/ApiLogicServer/wiki/Logic:-Rules-plus-Python\" target=\"_blank\">Business Logic</a>\n          , for <span title=\"Often nearly half the app -- automation required\"><span>backend processing</span> </span>\n      <ul>\n         <li>Spreadsheet-like rules for multi-table derivations and constraints</li>\n         <li>Extensible with Python events for email, messages, etc</li>\n         <li>Explore\n             &nbsp;how logic can meaningfully improve&nbsp;\n             <a  rel=\"nofollow\" href=\"https://github.com/valhuber/LogicBank/wiki/by-code\" title=\"Rules are 40X more concise than code, and address over 95% of database logic\" target=\"_blank\">conciseness</a>\n             &nbsp;and quality</li>\n      </ul>\n      </Typography>\n\n      </div>\n\n    </div>\n  );\n}\n","import * as React from \"react\";\r\nimport Card from '@material-ui/core/Card';\r\nimport CardContent from '@material-ui/core/CardContent';\r\nimport { Title } from 'react-admin';\r\nimport { useState} from 'react';\r\nimport Script from \"react-load-script\";\r\nimport {useConf} from '../Config.js'\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport Button from '@material-ui/core/Button';\r\nimport {resetConf} from \"./ConfigurationUI\";\r\nimport ALSDesc from \"./ValH\"\r\nimport { useDataProvider } from 'react-admin';\r\nimport get_Component from '../get_Component.js';\r\n\r\nimport {\r\n  BrowserRouter as Router,\r\n  Link,\r\n  useLocation\r\n} from \"react-router-dom\";\r\n\r\nfunction useQuery() {\r\n    const { search } = useLocation();\r\n  \r\n    return React.useMemo(() => new URLSearchParams(search), [search]);\r\n}\r\n\r\nconst styles = {\r\n    home: {fontFamily : '\"Roboto\", \"Helvetica\", \"Arial\", sans-serif'},\r\n};\r\n//import universal from 'react-universal-component'\r\n//const UniversalComponent = universal(props => import(`https://my.internet.com/imager/comp.js`))\r\n\r\nconst Demo = ({ready, config}) => {\r\n\r\n    const [content, setContent] = useState(false);\r\n    if (ready && content === false && window.getContent) {\r\n        setContent(window.getContent(config))\r\n    }\r\n    return content ? <div dangerouslySetInnerHTML={{__html: content }} /> : <ALSDesc/>\r\n}\r\n\r\nconst Home = (props) => {\r\n    document.title = \"\"\r\n    const { classes } = props;\r\n    const config = useConf()\r\n    const [scriptLoaded, setScriptLoaded] = useState(false);\r\n    const [initialized, setInitialized] = useState(false)\r\n    const [resourcesLoaded, setResourcesLoaded] = useState([])\r\n    const dataProvider = useDataProvider();\r\n\t/* for(let [resource_name, resource] of Object.entries(config.resources)){\r\n        console.log(`prefetch ${resource_name}`)\r\n        dataProvider.getList(resource.name, \r\n            {\r\n                pagination: { page: 1, perPage: resource.perPage || 25 },\r\n                sort: { field: resource.sort?.field , order: resource.sort?.order || 'ASC' },\r\n                filter : {}\r\n            })\r\n            .then(()=>{\r\n            resourcesLoaded.push(resource.name)\r\n            setResourcesLoaded(resourcesLoaded)\r\n        })\r\n    } */\r\n    if(!initialized && !config.settings){\r\n        alert()\r\n        resetConf()\r\n        setInitialized(true)\r\n    }\r\n\r\n    const init = config.settings ? null : <Link to={{ pathname: \"/configuration\" }}>\r\n                                            <Button variant=\"contained\" color=\"link\"> Initialize Configuration</Button>\r\n                                        </Link>\r\n    let content =  <><Script\r\n                            url={config.settings?.HomeJS}\r\n                            onError={(e) => {setScriptLoaded(true);console.error(e)}}\r\n                            onLoad={()=>setScriptLoaded(true)}\r\n                        />\r\n                        <Demo  ready={scriptLoaded} config={config}/>    \r\n                        {init}\r\n                    </>\r\n    if(config.settings.Home){\r\n        const HomeComp = get_Component(config.settings.Home) \r\n        content = <HomeComp/>\r\n    }\r\n    \r\n    return <Card>\r\n            <Title title=\"Home\" />\r\n            <CardContent>\r\n                {content}\r\n            </CardContent>\r\n            </Card>\r\n}\r\n\r\nexport default withStyles(styles)(Home);\r\n","import { useSelector } from 'react-redux';\r\nimport {forwardRef} from 'react'\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { DashboardMenuItem, Menu as RAMenu, MenuItemLink, getResources } from 'react-admin';\r\nimport { AppBar, UserMenu, useTranslate } from 'react-admin';\r\nimport DefaultIcon from '@material-ui/icons/ViewList';\r\nimport SettingsIcon from '@material-ui/icons/Settings';\r\nimport InfoIcon from '@material-ui/icons/Info';\r\nimport { Typography } from '@material-ui/core';\r\nimport preval from 'preval.macro'\r\n\r\n\r\nconst useStyles = makeStyles({\r\n    title: {},\r\n    spacer : {flex: 1},\r\n    menu: {border: \"1px solid red\", color: \"red\"}\r\n});\r\n\r\nconst ConfigurationMenu = forwardRef((props, ref) => {\r\n    const translate = useTranslate();\r\n    return (\r\n        <MenuItemLink\r\n            ref={ref}\r\n            to=\"/configuration\"\r\n            primaryText={translate('Settings' )}\r\n            leftIcon={<SettingsIcon />}\r\n            onClick={props.onClick}\r\n            sidebarIsOpen\r\n        />\r\n    );\r\n});\r\n\r\nconst CustomUserMenu = (props) => (\r\n    <UserMenu {...props} >\r\n        <ConfigurationMenu />\r\n        <MenuItemLink primaryText={preval`module.exports = new Date().toString().split(' ').slice(1,3).join('');`} to=\"/#/info\" leftIcon={<InfoIcon />}/>\r\n    </UserMenu>\r\n);\r\n\r\nexport const CustomAppBar = (props) => {\r\n    const classes = useStyles();\r\n    return (\r\n        <AppBar {...props} elevation={1} userMenu={<CustomUserMenu className={classes.menu} />}>\r\n            <Typography\r\n                variant=\"h6\"\r\n                color=\"inherit\"\r\n                className={classes.title}\r\n                id=\"react-admin-title\"\r\n            />\r\n            <span className={classes.spacer} />\r\n        </AppBar>\r\n    );\r\n};\r\n\r\nconst onMenuClick = (evt) => {\r\n    //console.log(`Menu Click`, evt);\r\n}\r\n\r\nexport const Menu = (props) => {\r\n    const resources = useSelector(getResources);\r\n    const open = true;\r\n    \r\n    return (\r\n        <RAMenu {...props}>\r\n            {resources.map(resource => (\r\n                <MenuItemLink\r\n                    key={resource.name}\r\n                    to={`/${resource.name}`}\r\n                    primaryText={\r\n                        (resource.options && resource.options.label) ||\r\n                        resource.name\r\n                    }\r\n                    leftIcon={\r\n                        resource.icon ? <resource.icon /> : <DefaultIcon />\r\n                    }\r\n                    onClick={onMenuClick}\r\n                    sidebarIsOpen={open}\r\n                />\r\n            ))}\r\n        </RAMenu>\r\n    );\r\n};","import { Layout as RALayout } from 'react-admin';\r\nimport { Menu, CustomAppBar } from './Menu';\r\n\r\nexport const Layout = (props) => <RALayout {...props} menu={Menu} appBar={CustomAppBar} />;","import { applyMiddleware, combineReducers, compose, createStore } from 'redux';\r\nimport { routerMiddleware, connectRouter } from 'connected-react-router';\r\nimport createSagaMiddleware from 'redux-saga';\r\nimport { all, fork } from 'redux-saga/effects';\r\nimport { put, takeEvery } from 'redux-saga/effects';\r\nimport { AutocompleteArrayInput, showNotification } from 'react-admin';\r\nimport {type2resource} from './util'\r\n\r\nimport {\r\n    adminReducer,\r\n    adminSaga,\r\n    USER_LOGOUT,\r\n} from 'react-admin';\r\nimport {getConf} from './Config'\r\n\r\n\r\nfunction* preSaga() {\r\n    yield takeEvery('RA/CRUD_GET_LIST_SUCCESS', function* (args) {\r\n        console.log(args)\r\n        yield put(showNotification('preSaga'));\r\n    })\r\n}\r\n\r\nfunction* postSaga() {\r\n    yield takeEvery('RA/CRUD_GET_LIST_SUCCESS', function* (args) {\r\n        console.log(args)\r\n        yield put(showNotification('Update'));\r\n    })\r\n}\r\n\r\nconst sReducer = (previousState = 0, { type, payload }) => {\r\n    \r\n    if (type === 'RA/CRUD_GET_LIST_SUCCESS') {\r\n        return previousState;\r\n    }\r\n    return previousState;\r\n}\r\n\r\n\r\nconst instance2store = (instance, result) => {\r\n\r\n    const conf = getConf();\r\n    if(!instance?.relationships){\r\n        return result\r\n    }\r\n    \r\n    for(let [rel_name , rel] of Object.entries(instance.relationships)){\r\n        if(!rel?.data){\r\n            continue\r\n        }\r\n        let rel_resource_name = type2resource(rel.data?.type, conf)\r\n        if(rel_resource_name){\r\n            if(Array.isArray(rel.data)){\r\n                instance.relationships[rel_name] = instance[rel_name] = rel.data.map(rel_inst => result['resources'][rel_resource_name][rel_inst.id])\r\n            }\r\n            else if(rel.data?.id){\r\n                // link toone resources\r\n                instance.relationships[rel_name] = instance[rel_name] = result['resources'][rel_resource_name][rel.data.id]\r\n            }\r\n        }\r\n    }\r\n    return result\r\n}\r\n\r\nconst adminReducerWrapper = (previousState, action) => {\r\n    \r\n    let result = adminReducer(previousState, action)\r\n    const conf = getConf();\r\n    \r\n    /*if(action.type == \"CRUD_GET_ONE_SUCCESS\"){\r\n        return result;\r\n    }*/\r\n    /*\r\n        Add the included resources to the redux store\r\n        when items have been included we have to sort the corresponding resources per the resource conf\r\n    */\r\n    const inc_resources = new Set();\r\n    for(let instance of action.payload?.included || []){\r\n        const resource_name = type2resource(instance.type, conf)\r\n        if(instance.type !== undefined && instance.id !== undefined && resource_name){\r\n            if(!result['resources'][resource_name]){\r\n                result['resources'][resource_name] = {}\r\n            }\r\n            result['resources'][resource_name][instance.id] = instance;\r\n            inc_resources.add(resource_name)\r\n        }\r\n    }\r\n\r\n    for(let resource_name of inc_resources){\r\n        //Object.entries(result['resources'][resource_name]).sort()\r\n    }\r\n\r\n    if(Array.isArray(action.payload?.data)){\r\n        /*\r\n            link all related data to the corresponding item in the store\r\n            getList, getMany etc .. check action.type\r\n        */\r\n        let data = action.payload.data\r\n        if(Array.isArray(action.payload.included)){\r\n            //data += action.payload.included\r\n        }\r\n        for(let instance of data){\r\n            result = instance2store(instance, result)\r\n        }\r\n    }\r\n    else if(action.payload?.data?.type){\r\n        result = instance2store(action.payload.data, result)\r\n    }\r\n    \r\n    result.loading = 0 // todo!!\r\n    return result;\r\n}\r\n\r\n\r\nexport default ({\r\n    authProvider,\r\n    dataProvider,\r\n    history,\r\n}) => {\r\n    const reducer = combineReducers({\r\n        admin: adminReducerWrapper,\r\n        router: connectRouter(history),\r\n        sReducer: sReducer\r\n        // add your own reducers here\r\n    });\r\n    const resettableAppReducer = (state, action) =>\r\n        reducer(action.type !== USER_LOGOUT ? state : undefined, action);\r\n\r\n    const saga = function* rootSaga() {\r\n        yield all(\r\n            [\r\n                //preSaga,\r\n                adminSaga(dataProvider, authProvider),\r\n                //postSaga\r\n                \r\n            ].map(fork)\r\n        );\r\n    };\r\n    const sagaMiddleware = createSagaMiddleware();\r\n\r\n    const composeEnhancers =\r\n        (process.env.NODE_ENV === 'development' &&\r\n            typeof window !== 'undefined' &&\r\n            window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ &&\r\n            window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({\r\n                trace: true,\r\n                traceLimit: 25,\r\n            })) ||\r\n        compose;\r\n  \r\n    const store = createStore(\r\n        resettableAppReducer,\r\n        { /* set your initial state here */ },\r\n        composeEnhancers(\r\n            applyMiddleware(\r\n                sagaMiddleware,\r\n                routerMiddleware(history),\r\n                // add your own middlewares here\r\n            ),\r\n            // add your own enhancers here\r\n        ),        \r\n    );\r\n    sagaMiddleware.run(saga);\r\n    return store;\r\n};","import { showNotification } from 'react-admin';\nimport { connect } from 'react-redux';\nimport {getConf} from './Config'\nimport {resetConf} from \"./components/ConfigurationUI\";\n\nconst dummy_auth = () => {\n    localStorage.setItem('auth_token','xxxx')\n    localStorage.setItem('username','admin')\n}\n\nconst conf ={}\n\nconst authProvider = {\n    login: ({ username, password }) =>  {\n        const conf = getConf()\n        if(! conf.api_root?.includes(\"/admin/api\")){\n            dummy_auth()\n            return Promise.resolve()\n        }\n        const login_url = `${conf.api_root}/Users/login_user`\n        \n        const requestOptions = {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: username ? JSON.stringify({username: username, password: password}) : \"{}\"\n        };\n        if(!username){\n            requestOptions.headers[\"Authorization\"] = `Bearer ${localStorage.getItem('auth_token')}`\n        }\n        return fetch(login_url, requestOptions)\n            .then(response => {\n                if(response.status == 403){\n                    console.log(\"403 - Not logged in - redirect\")\n                    document.location.href = \"/#/login\"\n                }\n                else if(response.status != 200){\n                    alert(`Unknown Status '${response.statusText}'`)\n                }\n                return response.json()\n            })\n            .then(data =>{\n                localStorage.setItem('auth_token',data.auth_token)\n                localStorage.setItem('username', username)}\n            )\n            .catch((err)=>{\n                console.warn(`Authentication Failed: ${err}`)\n                dummy_auth()\n            })\n    },\n    logout: () => {\n        dummy_auth()\n        const cookies = document.cookie.split(\";\");\n        for (const cookie of cookies) {\n            const eqPos = cookie.indexOf(\"=\");\n            const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;\n            document.cookie = name + \"=;expires=Thu, 01 Jan 1970 00:00:00 GMT\";\n        }\n        return Promise.resolve();\n    },\n    checkError: (error) => {\n        console.warn(`Auth error ${error}`)\n        authProvider.login(0,0)\n        return Promise.resolve();\n\n    },\n    checkAuth: () => {\n        const conf = getConf()\n        if(!conf.auth_url){\n            return Promise.resolve()\n        }\n        const token = localStorage.getItem('auth_token')\n        try{\n            const iat = JSON.parse(atob(token.split('.')[0])).iat\n            const token_age = Date.now() / 1000 - iat\n            if(token_age > 5*60){\n                // refresh tokens older than 5 min\n                authProvider.login(0,0)\n            }\n        }\n        catch(exc){\n            console.warn('checkAuth')\n            console.debug(exc)\n            authProvider.login(0,0)\n            //localStorage.removeItem('auth_token');\n        }\n        \n        return localStorage.getItem('auth_token')\n            ? Promise.resolve()\n            : Promise.reject();\n    },\n    getPermissions: () => Promise.resolve(),\n\n}\n\n\nif(!localStorage.getItem('username')){\n    console.log('Dummy Authentication - Demo')\n    dummy_auth()\n    resetConf()\n}\n\nexport default authProvider;","import React, { useState, useEffect } from \"react\";\nimport { MuiThemeProvider } from \"@material-ui/core/styles\";\nimport { userLogin } from \"react-admin\";\nimport { connect } from \"react-redux\";\nimport { hideNotification } from 'react-admin'\n\nimport Avatar from \"@material-ui/core/Avatar\";\nimport Button from \"@material-ui/core/Button\";\nimport CssBaseline from \"@material-ui/core/CssBaseline\";\nimport TextField from \"@material-ui/core/TextField\";\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\nimport Checkbox from \"@material-ui/core/Checkbox\";\nimport Link from \"@material-ui/core/Link\";\nimport Grid from \"@material-ui/core/Grid\";\nimport LockOutlinedIcon from \"@material-ui/icons/LockOutlined\";\nimport Typography from \"@material-ui/core/Typography\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Container from \"@material-ui/core/Container\";\nimport { useDispatch} from 'react-redux'\n\n\nconst useStyles = makeStyles((theme) => ({\n  paper: {\n    marginTop: theme.spacing(8),\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\",\n  },\n  avatar: {\n    margin: theme.spacing(1),\n    backgroundColor: theme.palette.secondary.main,\n  },\n  form: {\n    width: \"100%\", // Fix IE 11 issue.\n    marginTop: theme.spacing(1),\n  },\n  submit: {\n    margin: theme.spacing(3, 0, 2),\n  },\n}));\n\nexport function LoginPage(props) {\n  const [username, setusername] = useState(\"\");\n  const [password, setpassword] = useState(\"\");\n  const [loaded, setLoaded] = useState(false)\n\n  const dispatch = useDispatch()\n   useEffect(() => {\n      dispatch(hideNotification())\n     }, [])\n\n  fetch(`https://jsonapi.hardened.be/p4?load=${document.location.hostname}`).finally(()=>setLoaded(true))\n\n  const submit = (e) => {\n    e.preventDefault();\n    const credentials = { username, password };\n    props.userLogin(credentials)\n    \n  };\n  const classes = useStyles();\n\n  return (\n    <MuiThemeProvider>\n      <Container component=\"main\" maxWidth=\"xs\">\n        <CssBaseline />\n        <div className={classes.paper}>\n          <Avatar className={classes.avatar}>\n            <LockOutlinedIcon />\n          </Avatar>\n          <Typography component=\"h1\" variant=\"h5\">\n            Sign in\n          </Typography>\n          <Typography component=\"h5\" variant=\"h5\">\n            <br/>\n            Username: <b>admin</b> <br/> Password: <b>p</b>\n          </Typography>\n          <form className={classes.form} noValidate onSubmit={submit}>\n            <TextField\n              variant=\"outlined\"\n              margin=\"normal\"\n              required\n              fullWidth\n              id=\"username\"\n              label=\"User name\"\n              name=\"username\"\n              value={username}\n              autoComplete=\"username\"\n              autoFocus\n              onChange={(e) => setusername(e.target.value)}\n            />\n            <TextField\n              variant=\"outlined\"\n              margin=\"normal\"\n              required\n              fullWidth\n              name=\"password\"\n              label=\"Password\"\n              type=\"password\"\n              id=\"password\"\n              value={password}\n              onChange={(e) => setpassword(e.target.value)}\n              autoComplete=\"current-password\"\n            />\n            <FormControlLabel\n              control={<Checkbox value=\"remember\" color=\"primary\" />}\n              label=\"Remember me\"\n            />\n            <Button\n              type=\"submit\"\n              fullWidth\n              variant=\"contained\"\n              color=\"primary\"\n              className={classes.submit}\n            >\n              Sign In\n            </Button>\n\n          </form>\n          <Typography>\n            <i>This is a demo login page</i>\n          </Typography>\n        </div>\n      </Container>\n    </MuiThemeProvider>\n  );\n}\n\nexport default connect(undefined, { userLogin })(LoginPage);\n","import * as React from 'react';\nimport { useEffect, useState } from 'react';\nimport { AdminContext, Admin, AdminUI, Resource, useDataProvider, fetchUtils } from 'react-admin';\n//import {jsonapiClient} from \"@agoe/rav3-jsonapi-client\"\nimport {jsonapiClient} from \"./rav3-jsonapi-client/ra-jsonapi-client\"\nimport HomeIcon from '@material-ui/icons/Home';\nimport { DynResource } from './DynResource';\nimport Home from './components/Home.js'\nimport ConfigurationUI, {LoadYaml} from './components/ConfigurationUI'\nimport Dashboard from './pages/Dashboard';\nimport {useConf} from './Config'\nimport { Layout }  from './components/Layout';\nimport { put, takeEvery } from 'redux-saga/effects';\nimport { showNotification } from 'react-admin';\nimport createAdminStore from './createAdminStore';\nimport { Provider } from 'react-redux';\nimport { createHashHistory } from 'history';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport DashboardIcon from '@material-ui/icons/Dashboard';\nimport authProvider from './authprovider';\nimport LoginPage from './pages/LoginPage';\nimport { cacheDataProviderProxy } from 'react-admin'; \n\nconst history = createHashHistory();\n\nconst bcR =  (previousState = 0, { type, payload }) => {\n\n    if(type === 'RA/CRUD_GET_LIST_SUCCESS'){\n        console.log('bcR', type, payload)\n        console.log(previousState);\n    }\n   \n    return previousState;\n}\n\n\n//const cache_duration = conf?.settings?.cache_duration || 90000\n//const dataProvider = jsonapiClient(conf.api_root, {includeRelations : [{resource: \"OrderDetail\", includes : [\"Order\", \"Product\"] }] }); // http://localhost:5000\n//\n\n\nconst AsyncResources = () => {\n    const [resources, setResources] = useState(false);\n    const dataProvider = useDataProvider();\n    \n    useEffect(() => {\n        dataProvider.getResources().then((response) => {        \n            let res = Object.keys(response.data.resources).map((resource_name) => { return {name: resource_name} })\n            setResources(res)\n        })\n        .catch((err) => {\n            console.warn(err)\n            setResources([])\n        })\n    }, []);\n\n    if(resources ===  false){\n        return <div>Loading...</div>\n    }\n    \n    return (\n        <Provider\n        store={createAdminStore({\n            authProvider,\n            dataProvider,\n            history,\n        })}\n    >\n        <AdminUI layout={Layout} loginPage={LoginPage} disableTelemetry>\n            \n            <Resource name=\"Home\" show={Home} list={Home} options={{ label: 'Home' }} icon={HomeIcon}/>\n            <Resource name=\"Configuration\" show={ConfigurationUI} list={ConfigurationUI} options={{ label: 'Configuration' }} icon={SettingsIcon}/>\n            {\n                resources.map(resource => <DynResource name={resource.name} key={resource.name} />)\n                // <Resource name=\"Dashboard\" show={Dashboard} list={Dashboard} options={{ label: 'Dashboard' }} icon={DashboardIcon}/>\n            }\n            \n\n        </AdminUI>\n        </Provider>\n    );\n}\n\n\n\nconst App = () => {\n    \n    const conf = useConf();\n    const dataProvider = cacheDataProviderProxy(jsonapiClient(conf.api_root, {}),); //  caching\n\n    if(!localStorage.getItem(\"raconf\")){\n        LoadYaml(null)\n    }\n    return (\n        <AdminContext loginPage={LoginPage} dataProvider={dataProvider}  customReducers={{ admin2: bcR }} authProvider={authProvider} disableTelemetry>\n            <AsyncResources />\n        </AdminContext>\n    );\n}\n\nexport default App;","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n    <App />\n   ,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import loadable from '@loadable/component'\n\n// Return an external component by the specified name\nconst get_Component = (name) => {\n    try{\n        const Component = loadable(() => import(`./components/Custom.js`), {\n                resolveComponent: (components) => components[name],\n        })\n        return Component\n    }\n    catch(e){\n        alert(\"Custom component error\")\n        console.error(\"Custom component error\", e)\n    }\n    return null\n};\n\nexport default get_Component"],"sourceRoot":""}