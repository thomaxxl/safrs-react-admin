{"version":3,"sources":["rav3-jsonapi-client/errors.ts","rav3-jsonapi-client/default-settings.ts","rav3-jsonapi-client/resourceLookup.ts","Config.js","rav3-jsonapi-client/ra-jsonapi-client.ts","components/JoinModal.js","DynResource.js","components/Home.js","components/ConfigurationUI.js","components/Menu.js","components/Layout.js","createAdminStore.js","App.js","reportWebVitals.js","index.js","../node_modules/typescript/lib sync"],"names":["SafrsHttpError","Error","message","status","body","name","HttpError","defaultSettings","total","headers","Accept","updateMethod","arrayFormat","includeRelations","errorHandler","httpError","errors","length","alert","title","code","console","log","endpointToTypeStripLastLetters","ResourceLookup","response","lookup","includes","this","Map","resources","Object","prototype","hasOwnProperty","call","data","included","entry","key","getKey","set","resource","type","id","has","get","ret","assign","ja_type","attributes","relationships","get_Conf","localStorage","setItem","JSON","stringify","config","window","location","reload","result","settings","api_url","lsc_str","getItem","parse","entries","e","warn","resource_name","tab_groups","Array","tg","target","concat","tab_group_name","tab_group","push","search_cols","sort_attr_names","attr","constructor","rel","fks","fk","relationship","target_resource","search","sort","join","max_list_columns","locale","options","defaultOptions","languageCodeOnly","opt","browserLocales","undefined","navigator","languages","language","map","trimmedLocale","trim","split","getBrowserLocales","reset_Conf","default_configs","als_config","conf","validUntil","style","position","top","left","transform","width","bgcolor","border","boxShadow","p","textAlign","JoinModal","label","content","React","open","setOpen","onClick","stopPropagation","className","Modal","onClose","Box","sx","Typography","variant","component","mt","useStyles","makeStyles","join_attr","color","searchFilters","TextInput","source","alwaysOn","type2resource","AttrField","attribute","TextField","DateField","locales","Component","loadable","resolveComponent","components","error","JoinedField","record","useRecordContext","rel_name","user_key","useQueryWithStore","payload","loading","item","user_component","component_name","LabelComponent","instance","load_custom_component","filter","col","attr_fields","hidden","header_style","DynPagination","props","Pagination","rowsPerPageOptions","perPage","DetailPanel","Grid","container","spacing","margin","m","deleteField","dataProvider","refresh","delete","then","catch","DynInput","fullWidth","DateInput","direction","input","AutocompleteInput","optionText","ReferenceInput","reference","xs","ResourceTitle","ShowRecordField","attr_name","value","jf","ShowField","ShowInstance","tabs","TabbedShowLayout","TabbedShowLayoutTabs","scrollButtons","useState","setLoading","setError","setRelated","useDataProvider","useEffect","getOne","fields","col_nr","Tab","ReferenceManyField","addLabel","pagination","Datagrid","rowClick","expand","slice","EditButton","DynRelationshipMany","related","rel_resource","rel_id","DynRelationshipOne","SimpleShowLayout","RelatedInstance","resource_conf","Button","Link","to","pathname","DynResource","addEventListener","List","useMemo","ButtonField","useRefresh","edit","FunctionField","render","fill","ShowButton","filters","Create","SimpleForm","Edit","useNotify","redirect","useRedirect","onFailure","basePath","gen_DynResourceEdit","Show","gen_DynResourceShow","Resource","list","create","show","Content","Demo","ready","setContent","getContent","dangerouslySetInnerHTML","__html","Home","scriptLoaded","setScriptLoaded","Card","Title","CardContent","url","HomeJS","onError","onLoad","yaml","require","als_yaml_url","href","theme","widget","marginRight","marginTop","marginBottom","textInput","modal","LoadYaml","config_url","saveYaml","ystr","configs","api_root","addConf","load","fetch","cache","text","err","ManageModal","classes","config_list","conf_name","confirm","DeleteConf","textFieldRef","useRef","inputRef","evt","current","ConfSelect","current_conf","setCurrent","minWidth","FormControl","InputLabel","Select","labelId","size","onChange","event","new_conf","defaultValue","MenuItem","ConfigurationUI","saveEdit","parsed_conf","setApiroot","setBgColor","taConf","setTaConf","resetConf","defconf","bgColor","autosave","setAutosave","saveConfig","FormControlLabel","control","Checkbox","checked","dump","height","borderLeft","ev","jj","TextareaAutosize","minRows","backgroundColor","onMenuClick","Menu","useSelector","getResources","MenuItemLink","primaryText","leftIcon","icon","sidebarIsOpen","DashboardMenuItem","Layout","menu","sReducer","previousState","adminReducerWrapper","action","adminReducer","Date","now","inc_resources","Set","add","isArray","rel_resource_name","rel_inst","authProvider","history","reducer","combineReducers","admin","router","connectRouter","saga","rootSaga","all","adminSaga","fork","sagaMiddleware","createSagaMiddleware","composeEnhancers","compose","store","createStore","state","USER_LOGOUT","applyMiddleware","routerMiddleware","run","createHashHistory","bcR","apiUrl","userSettings","httpClient","fetchUtils","fetchJson","countHeader","merge","getList","params","page","query","q","op","val","format","keys","forEach","field","prefix","order","json","meta","jsonData","unwrapData","Promise","reject","getMany","ids","getManyReference","debug","update","arr","i","endsWith","method","updateMany","responses","Headers","deleteMany","resolve","jsonapiClient","AsyncResources","setResources","res","createAdminStore","AdminUI","layout","HomeIcon","SettingsIcon","App","AdminContext","customReducers","admin2","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","document","getElementById","webpackEmptyContext","req","module","exports"],"mappings":"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","file":"static/js/main.adbebe10.chunk.js","sourcesContent":["import { HttpError } from 'react-admin';\n\nexport class NotImplementedError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.message = message;\n    this.name = 'NotImplementedError';\n  }\n}\n\nexport class SafrsHttpError extends HttpError {\n  constructor(message: string, status: number, body: any) {\n    super(message, status, body);\n    this.name = 'SafrsHttpError';\n  }\n}\n\nexport const safrsErrorHandler: HttpErrorHandler = (\n  httpError: HttpError\n): HttpError => {\n  /* Example Safrs Error message\n  {\n    \"errors\": [\n      {\n        \"title\": \"Request forbidden -- authorization will not help\",\n        \"detail\": \"\",\n        \"code\": \"403\"\n      }\n    ]\n  } */\n  interface err {\n    title: string;\n    detail: string;\n    code: string;\n  }\n  const errors: { errors: err[] } = httpError.body; // JSON.parse(httpError.body.stringify);\n  if (errors?.errors.length > 0) {\n    alert(\"Error \"+ errors.errors[0].title)\n    return new SafrsHttpError(\n      errors.errors[0].title,\n      httpError.status,\n      errors.errors[0].code\n    );\n  } else {\n    console.log('Unsopported Http Error Body', httpError.body);\n    return httpError;\n  }\n};\n\nexport interface HttpErrorHandler {\n  (httpError: HttpError): HttpError;\n}\n","import { safrsErrorHandler, HttpErrorHandler } from './errors';\nimport { includeRelations } from './ra-jsonapi-client';\n\nexport const defaultSettings: settings = {\n  total: 'total',\n  headers: {\n    Accept: 'application/vnd.api+json; charset=utf-8',\n    'Content-Type': 'application/vnd.api+json; charset=utf-8'\n  },\n  updateMethod: 'PATCH',\n  arrayFormat: 'brackets',\n  includeRelations: [],\n  errorHandler: safrsErrorHandler,\n  endpointToTypeStripLastLetters: ['Model', 's'] // update/create type: UserModel -> User, Users -> User\n};\n\ninterface settings {\n  total: string;\n  headers: {};\n  updateMethod: string;\n  arrayFormat: string;\n  includeRelations: includeRelations[];\n  errorHandler: HttpErrorHandler;\n  endpointToTypeStripLastLetters?: string[];\n}\n","/**\n * A map-like class that maps resource linkage objects {id: 1, type: \"user\"} to concrete resources with attributes and\n * relationships\n */\nexport default class ResourceLookup {\n  lookup: Map<any, any>;\n  includes: string[];\n  /**\n   * Constructs a new lookup map\n   * @param {Object} response A JSON API response, in JSON format\n   */\n  constructor(response: any) {\n    this.lookup = new Map();\n    this.includes = [];\n\n    // If the response wasn't a JSON dictionary, we can't and don't need to build a lookup\n    if (typeof response !== 'object') return;\n\n    let resources;\n    // if (response.hasOwnProperty('included')) {\n    if (Object.prototype.hasOwnProperty.call(response, 'included')) {\n      resources = [...response.data, ...response.included];\n    } else {\n      resources = response.data;\n    }\n\n    // Iterate over each resource returned and put each in the lookup\n    for (const entry of resources) {\n      const key = this.getKey(entry);\n      this.lookup.set(key, entry);\n    }\n  }\n\n  /**\n   * Calculates a hashable key for JSON API resources\n   * @param resource A resource linkage object\n   * @returns {string}\n   */\n  getKey(resource: any) {\n    return `${resource.type}:${resource.id}`;\n  }\n\n  /**\n   * Looks up a resource\n   * @param resource A resource linkage object\n   * @returns {Object}\n   */\n  get(resource: any) {\n    // If we don't have included data for this resource, just return the Resource Linkage object, since that's still\n    // useful\n    if (this.has(resource)) {\n      return this.lookup.get(this.getKey(resource));\n    } else {\n      return resource;\n    }\n  }\n\n  /**\n   * Returns true if the resource is in the lookup\n   * @param resource\n   * @returns {boolean}\n   */\n  has(resource: any) {\n    return this.lookup.has(this.getKey(resource));\n  }\n\n  /**\n   * Converts a JSON API data object (with id, type, and attributes fields) into a flattened object\n   * @param {Object} response A JSON API data object\n   */\n  unwrapData(response: any, includes: string[]) {\n    // The base resource object\n    const ret = Object.assign(\n      {\n        id: response.id,\n        ja_type: response.type\n      },\n      response.attributes\n    );\n    if (includes.length === 0) {\n      // shortcut, no includes: scip relationships\n      return ret;\n    }\n    // Deal with relationships\n\n    if (Object.prototype.hasOwnProperty.call(response, 'relationships')) {\n      ret.relationships = response.relationships;\n      \n    }\n\n    return ret;\n  }\n}\n\nfunction lowerFirstLetter(s: string): string {\n  return s;\n  return s[0].toLowerCase() + s.slice(1);\n}\n","import config from './Config.json'\r\nimport als_config from './Config.als.json'\r\n\r\nconst init_Conf = () => {\r\n    if(! \"raconf\" in localStorage){\r\n        console.log(\"Init Configuration\")\r\n        localStorage.setItem(\"raconf\",JSON.stringify(config))\r\n        window.location.reload()\r\n    }\r\n}\r\n\r\nconst getBrowserLocales = (options = {}) => {\r\n    const defaultOptions = {\r\n      languageCodeOnly: false,\r\n    };\r\n    const opt = {\r\n      ...defaultOptions,\r\n      ...options,\r\n    };\r\n    const browserLocales =\r\n      navigator.languages === undefined\r\n        ? [navigator.language]\r\n        : navigator.languages;\r\n    if (!browserLocales) {\r\n      return undefined;\r\n    }\r\n    return browserLocales.map(locale => {\r\n      const trimmedLocale = locale.trim();\r\n      return opt.languageCodeOnly\r\n        ? trimmedLocale.split(/-|_/)[0]\r\n        : trimmedLocale;\r\n    });\r\n  }\r\n\r\nexport const get_Conf = () => {\r\n\r\n    init_Conf();\r\n\r\n    let ls_conf = null\r\n    let result = {settings: {}, api_url : null}\r\n    const lsc_str = localStorage.getItem(\"raconf\")\r\n    try{\r\n        ls_conf = JSON.parse(lsc_str)\r\n        result = ls_conf ? ls_conf : JSON.parse(JSON.stringify(config)) || {};\r\n        Object.entries(result.resources)\r\n    }\r\n    catch(e){\r\n        console.warn(`Failed to parse config ${lsc_str}`)\r\n        localStorage.setItem(\"raconf\", JSON.stringify(config))\r\n    }\r\n\r\n    if(!result.resources){\r\n        result.resources = {}\r\n    }\r\n    const resources = result.resources\r\n\r\n    for(let [resource_name, resource] of Object.entries(resources||{})){\r\n        resource.relationships = resource.relationships || []\r\n        if(resource.tab_groups instanceof Array){\r\n            for(let tg of resource.tab_groups){\r\n                tg.target = tg.resource\r\n            }\r\n            resource.relationships = resource.relationships.concat(resource.tab_groups)\r\n        }\r\n        else {\r\n            // dict: deprecated soon\r\n            for(let [tab_group_name, tab_group] of Object.entries(resource.tab_groups || {}) ){\r\n                resource.relationships.push(Object.assign(tab_group, {name: tab_group_name, target: tab_group.resource}))\r\n            }\r\n        }\r\n        // link relationship to FK column\r\n        if(!(resource.attributes instanceof Array || resource.relationships instanceof Array)){\r\n            continue\r\n        }\r\n\r\n        if(!resource.type){\r\n            resource.type = resource_name\r\n        }\r\n\r\n        resource.search_cols = []\r\n        resource.sort_attr_names = []\r\n        result.resources[resource_name].name = resource_name\r\n        let attributes = resource.attributes || []\r\n\r\n        for(let attr of attributes){\r\n            if(!(attr.constructor == Object)){\r\n                console.warn(`Invalid attribute ${attr}`)\r\n                continue\r\n            }\r\n            for(let rel of resource.relationships || []){\r\n                for(let fk of rel.fks || []){\r\n                    if(attr.name == fk){\r\n                        attr.relationship = rel;\r\n                        attr.relationship.target_resource = result.resources[attr.relationship.target]\r\n                    }\r\n                }\r\n            }\r\n            if(attr.search){\r\n                resource.search_cols.push(attr);\r\n            }\r\n            if(attr.sort){\r\n                resource.sort_attr_names.push(attr.name)\r\n                resource.sort = resource.sort_attr_names.join(',')\r\n            }\r\n        }\r\n        \r\n        resource.max_list_columns = resource.max_list_columns || result.settings?.max_list_columns || 8\r\n        console.log(`Loaded config resource ${resource_name}`, resource)\r\n    }\r\n    \r\n    if(result.settings){\r\n        result.settings.locale = result.settings.locale || getBrowserLocales()[0] || \"fr-FR\"\r\n    }\r\n    return result || reset_Conf()\r\n}\r\n\r\nexport const reset_Conf = (reload) => {\r\n    const configs = {}\r\n    console.log(\"Resetting conf\", config)\r\n    localStorage.setItem(\"raconf\", JSON.stringify(config));\r\n    //configs[config.api_root] = config\r\n    //configs[als_config.api_root] = als_config\r\n    \r\n    localStorage.setItem(\"raconfigs\", JSON.stringify(configs));\r\n\r\n    if(reload){\r\n        window.location.reload()\r\n    }\r\n    return config\r\n}\r\n\r\nexport const default_configs = [als_config, config];\r\n\r\nexport const conf = get_Conf()\r\n\r\nexport default conf","import { stringify } from 'query-string';\nimport { fetchUtils, DataProvider, HttpError } from 'react-admin';\nimport merge from 'deepmerge';\nimport { defaultSettings } from './default-settings';\nimport ResourceLookup from './resourceLookup';\nimport {get_Conf} from '../Config'\n\nconst conf : { [ key: string] : any } = get_Conf();\nconst validUntil = 1000;\n/**\n * Based on\n * \n * https://github.com/marmelab/react-admin/blob/master/packages/ra-data-simple-rest/src/index.ts\n * @see https://github.com/marmelab/FakeRest\n * \n */\nexport const jsonapiClient = (\n  apiUrl: string,\n  userSettings = {conf : {}},\n  httpClient = fetchUtils.fetchJson,\n  countHeader: string = 'Content-Range'\n): DataProvider => {\n  const settings = merge(defaultSettings, userSettings);\n  const conf__ = userSettings.conf;\n\n  \n  return {\n    /*******************************************************************************************\n     * getList\n     *******************************************************************************************/\n    getList: (resource, params) => {\n      /*todo: rename resource to resource_name*/\n      const resource_name = resource;\n      const { page, perPage } = params.pagination;\n      \n      const resource_conf : any = conf.resources[resource_name];\n      const sort : string = resource_conf.sort\n      // Create query with pagination params.\n      const query : {[k: string]: any} = {\n        'page[number]': page,\n        'page[size]': perPage,\n        'page[offset]': (page - 1) * perPage,\n        'page[limit]': perPage\n      };\n\n      if(sort){\n          query.sort = sort\n      }\n\n      console.log(params)\n      // Add all filter params to query.\n      if(params.filter?.q && \"resources\" in conf){\n          // search is requested by react-admin\n          const search_cols = resource_conf.attributes.filter((col : any) => col.search);\n          const filter = search_cols.map((col: any) => {return { \n                                \"name\":col.name,\n                                \"op\": col.op? col.op : \"ilike\",\n                                \"val\": col.val ? col.val.format(params.filter.q) : `%${params.filter.q}%`\n                              };})\n            query['filter'] = JSON.stringify(filter) // => startswith operator in sql\n      }\n      else{\n        Object.keys(params.filter || {}).forEach((key) => {\n          query[`filter[${key}]`] = params.filter[key];\n        });\n      }\n\n      // Add sort parameter, first check the default configured sorting, then the customized sort\n      if (params.sort && params.sort.field) {\n        const prefix = params.sort.order === 'ASC' ? '' : '-';\n        query.sort = `${prefix}${params.sort.field}`;\n      }\n      const rel_conf = conf.resources[resource_name].relationships || []\n      const includes: string[] = rel_conf.map((rel : any) => rel.name);\n      query['include'] = includes.join(',');\n\n      const url = `${apiUrl}/${resource}?${stringify(query)}`;\n\n      return httpClient(url)\n        .then(({ json }) => {\n          // const lookup = new ResourceLookup(json.data);\n          // When meta data and the 'total' setting is provided try\n          // to get the total count.\n          let total = 0;\n          if (json.meta && settings.total) {\n            total = json.meta[settings.total];\n          }\n          // Use the length of the data array as a fallback.\n          total = total || json.data.length;\n          const lookup = new ResourceLookup(json);\n          const jsonData = json.data.map((resource: any) =>{\n              return lookup.unwrapData(resource, includes)\n            }\n          );\n          return {\n            data: jsonData,\n            included: json.included,\n            //included: json.included.map((item: any) => lookup.unwrapData(item, [])),\n            validUntil : new Date(Date.now() + validUntil),\n            total: total\n          };\n        })\n        .catch((err: HttpError) => {\n          console.log('catch Error', err.body);\n          const errorHandler = settings.errorHandler;\n          return Promise.reject(errorHandler(err));\n        });\n    },\n\n    /*******************************************************************************************\n      getOne\n    ********************************************************************************************/\n    getOne: (resource: any, params: { id: any }) => {\n      //const url = `${apiUrl}/${resource}/${params.id}?include=%2Ball&page[limit]=50`;\n      const resource_conf = conf[\"resources\"][resource];\n      if(!resource_conf){\n        console.warn(`Invalid resource ${resource}`)\n        return new Promise(()=>{});\n      }\n      const rel_conf = resource_conf?.relationships || [];\n      const includes: string[] = rel_conf.map((rel : any) => rel.name).join(\",\")\n      \n      const url = `${apiUrl}/${resource}/${params.id}?include=${includes}`;\n      \n      return httpClient(url).then(({ json }) => {\n\n        const { id, attributes, relationships, type } = json.data;\n        //const included = json.included;\n        Object.assign(attributes, relationships, {type: type}, {relationships: relationships}, {attributes: {...attributes} });\n        return {\n          data: {\n            id,\n            validUntil : new Date(Date.now() + validUntil),\n            ...attributes\n          }\n        };\n      });\n    },\n\n    /*******************************************************************************************\n      getMany\n    ********************************************************************************************/\n    getMany: (resource, params) => {\n      resource = capitalize(resource);\n      /* const query = {\n        filter: JSON.stringify({ id: params.ids })\n      }; */\n      const query = 'filter[id]=' + JSON.stringify(params.ids);\n      // const url = `${apiUrl}/${resource}?${stringify(query)}`;\n      const url = `${apiUrl}/${resource}?${query}`;\n      return httpClient(url).then(({ json }) => {\n        console.log('gtMany', json);\n        // When meta data and the 'total' setting is provided try\n        // to get the total count.\n        let total = 0;\n        if (json.meta && settings.total) {\n          total = json.meta[settings.total];\n        }\n        // Use the length of the data array as a fallback.\n        total = total || json.data.length; //  { id: any; attributes: any; }\n        const jsonData = json.data.map((value: any) =>\n          Object.assign({ id: value.id, type: value.type }, value.attributes)\n        );\n\n        return {\n          data: jsonData,\n          validUntil : new Date(Date.now() + validUntil),\n          total: total\n        };\n      });\n    },\n\n    /*******************************************************************************************\n      getManyReference\n    ********************************************************************************************/\n    getManyReference: (resource, params : any) => {\n      console.log('GMR', params)\n      console.log(resource, params.target)\n      const fk = params.target\n      \n      const { page, perPage } = params.pagination;\n      const { field, order } = params.sort;\n\n      const query: {[k: string]: any} = {\n        sort: JSON.stringify([field, order]),\n      };\n      query[`filter[${fk}]`] = params.id\n      query[`page[limit]`] = perPage\n      query[`page[offset]`] = (page - 1) * perPage\n     \n      const options = {};\n      const resource_conf = conf[\"resources\"][resource];\n      const rel_conf = resource_conf?.relationships || [];\n      const includes: string[] = rel_conf.map((rel : any) => rel.name).join(\",\")\n      const url = `${apiUrl}/${resource}?${stringify(query)}&include=${includes}`\n      \n      return httpClient(url, options).then(({ headers, json }) => {\n        if (!headers.has(countHeader)) {\n          console.debug(\n            `The ${countHeader} header is missing in the HTTP Response. The simple REST data provider expects responses for lists of resources to contain this header with the total number of results to build the pagination. If you are using CORS, did you declare ${countHeader} in the Access-Control-Expose-Headers header?`\n          );\n        }\n        let total = json.meta?.total;\n        if (json.meta && settings.total) {\n          total = json.meta[settings.total];\n        }\n        // Use the length of the data array as a fallback.\n        total = total || json.data.length;\n        const lookup = new ResourceLookup(json);\n        const jsonData = json.data.map((resource: any) =>{\n          return lookup.unwrapData(resource, includes)\n          }\n        );\n\n        return {\n          data: jsonData,\n          total: total\n        };\n      });\n    },\n\n    update: (resource, params) => {\n      let type = conf[\"resources\"][resource].type;\n      const arr = settings.endpointToTypeStripLastLetters;\n      for (const i in arr) {\n        if (resource.endsWith(arr[i])) {\n          type = resource.slice(0, arr[i].length * -1);\n          break; // quit after first hit\n        }\n      }\n      const data = {\n        data: {\n          id: params.id,\n          type: type,\n          attributes: params.data\n        }\n      };\n\n      return httpClient(`${apiUrl}/${resource}/${params.id}`, {\n        method: settings.updateMethod,\n        body: JSON.stringify(data)\n      })\n        .then(({ json }) => {\n          const { id, attributes } = json.data;\n          /* const attributes = json.data;\n           delete attributes.id;\n          const updateData: any = {\n            any too keep compiler happy \n           data: {\n              id: params.id,\n              type: resource,\n              attributes: attributes\n            }\n          }; */\n          return {\n            data: {\n              id,\n              ...attributes\n            }\n          };\n        })\n        .catch((err: HttpError) => {\n          console.log('catch Error', err.body);\n          const errorHandler = settings.errorHandler;\n          return Promise.reject(errorHandler(err));\n        });\n    },\n\n    // simple-rest doesn't handle provide an updateMany route, so we fallback to calling update n times instead\n    updateMany: (resource, params) =>\n      Promise.all(\n        params.ids.map((id) =>\n          httpClient(`${apiUrl}/${resource}/${id}`, {\n            method: 'PUT',\n            body: JSON.stringify(params.data)\n          })\n        )\n      ).then((responses) => ({ data: responses.map(({ json }) => json.id) })),\n\n    /* create_old: (resource, params) =>\n      httpClient(`${apiUrl}/${resource}`, {\n        method: 'POST',\n        body: JSON.stringify(params.data)\n      }).then(({ json }) => ({\n        data: { ...params.data, id: json.id }\n      })), */\n\n    create: (resource, params) => {\n      let type = resource;\n      const arr = settings.endpointToTypeStripLastLetters;\n      for (const i in arr) {\n        if (resource.endsWith(arr[i])) {\n          type = resource.slice(0, arr[i].length * -1);\n          break; // quit after first hit\n        }\n      }\n      const data = {\n        data: {\n          type: type,\n          attributes: params.data\n        }\n      };\n      return httpClient(`${apiUrl}/${resource}`, {\n        method: 'POST',\n        body: JSON.stringify(data)\n      })\n        .then(({ json }) => {\n          const { id, attributes } = json.data;\n          return {\n            data: {\n              id,\n              ...attributes\n            }\n          };\n        })\n        .catch((err: HttpError) => {\n          console.log('catch Error', err.body);\n          const errorHandler = settings.errorHandler;\n          return Promise.reject(errorHandler(err));\n        });\n    },\n\n    delete: (resource, params) =>\n      httpClient(`${apiUrl}/${resource}/${params.id}`, {\n        method: 'DELETE',\n        headers: new Headers({\n          'Content-Type': 'text/plain'\n        })\n      }).then(({ json }) => ({ data: json })),\n\n    // simple-rest doesn't handle filters on DELETE route, so we fallback to calling DELETE n times instead\n    deleteMany: (resource, params) =>\n      Promise.all(\n        params.ids.map((id) =>\n          httpClient(`${apiUrl}/${resource}/${id}`, {\n            method: 'DELETE',\n            headers: new Headers({\n              'Content-Type': 'text/plain'\n            })\n          })\n        )\n      ).then((responses) => ({\n        data: responses.map(({ json }) => json.id)\n      })),\n\n    getResources: () => {\n        \n        if(conf){\n            return Promise.resolve({data: conf});\n        };\n        return httpClient(`${apiUrl}/schema`, {\n            method: 'GET'\n        }).then(({json}) => {\n            localStorage.setItem('raconf', JSON.stringify(json));\n            return { data: json };\n        })\n        .catch(()=> {return {data : {}} })\n      }\n    \n  };\n};\n\nfunction capitalize(s: string): string {\n  return s;\n  return s[0].toUpperCase() + s.slice(1);\n}\nexport interface includeRelations {\n  resource: string;\n  includes: string[];\n}\n","import * as React from 'react';\r\nimport Box from '@material-ui/core/Box';\r\nimport Button from '@material-ui/core/Button';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Modal from '@material-ui/core/Modal';\r\n\r\nconst style = {\r\n  position: 'absolute',\r\n  top: '50%',\r\n  left: '50%',\r\n  transform: 'translate(-50%, -50%)',\r\n  width: \"75%\",\r\n  bgcolor: 'background.paper',\r\n  border: '2px solid #000',\r\n  boxShadow: 24,\r\n  p: 4,\r\n  textAlign: \"left\"\r\n};\r\n\r\n\r\n\r\nexport default function JoinModal({label, content, resource_name}) {\r\n  const [open, setOpen] = React.useState(false);\r\n  const handleOpen = (e) => {setOpen(true); e.stopPropagation();}\r\n  const handleClose = (e) => {e.stopPropagation();setOpen(false);}\r\n\r\n  return (\r\n    <div>\r\n      <span onClick={handleOpen} className=\"JoinedField\" title={resource_name}>{label} </span>\r\n      <Modal\r\n        open={open}\r\n        onClose={handleClose}\r\n        aria-labelledby=\"modal-modal-title\"\r\n        aria-describedby=\"modal-modal-description\"\r\n      >\r\n        <Box sx={style}>\r\n          <Typography id=\"modal-modal-title\" variant=\"h6\" component=\"h2\">\r\n            {label}\r\n          </Typography>\r\n          <Typography id=\"modal-modal-description\" sx={{ mt: 2 }}>\r\n            {content}\r\n          </Typography>\r\n        </Box>\r\n      </Modal>\r\n    </div>\r\n  );\r\n}","import React from \"react\";\n\nimport { useState, useEffect, useMemo} from 'react';\nimport { List,\n    Datagrid,\n    TextField,\n    DateField,\n    EditButton,\n    ShowButton\n} from \"react-admin\";\nimport Grid from '@material-ui/core/Grid';\nimport { Resource, TabbedShowLayout, Tab } from 'react-admin';\nimport {\n  Edit,\n  Create,\n  Show,\n  SimpleForm,\n  TextInput,\n  DateInput,\n  SimpleShowLayout,\n  TabbedShowLayoutTabs,\n  ReferenceManyField,\n  useRecordContext,\n  Link\n} from \"react-admin\";\nimport { Typography } from '@material-ui/core';\nimport { useRefresh } from 'react-admin';\nimport { useDataProvider } from 'react-admin';\nimport { FunctionField } from 'react-admin';\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport EditIcon from \"@material-ui/icons/Edit\";\nimport KeyboardArrowRightIcon from '@material-ui/icons/KeyboardArrowRight';\nimport {get_Conf} from './Config.js'\nimport loadable from '@loadable/component'\nimport Popover from '@material-ui/core/Popover';\nimport Button from '@material-ui/core/Button';\nimport JoinModal from './components/JoinModal'\nimport { AutocompleteInput, ReferenceInput } from 'react-admin';\nimport { Pagination } from 'react-admin';\nimport './style/DynStyle.css'\nimport { useQueryWithStore, Loading, Error } from 'react-admin';\nimport { useNotify, useRedirect } from 'react-admin';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { Switch, Route } from \"react-router-dom\";\n\n\nimport { updateJsxAttribute } from \"typescript\";\nimport { configure } from \"@testing-library/react\";\n\n//import {ExtComp} from './components/ExtComp';\n\nconst conf = get_Conf();\n\nconst useStyles = makeStyles({\n    join_attr: { color: '#3f51b5;' },\n});\n\nconst searchFilters = [\n    <TextInput source=\"q\" label=\"Search\" alwaysOn />\n];\n\n\nconst type2resource = (type) => {\n    for(let [resource_name, resource] of Object.entries(conf?.resources)){\n        if(resource.type === type){\n            return resource_name\n        }\n    }\n    console.warn(`No resource for type \"${type}`)\n    return conf[type]\n}\n\n\nconst AttrField = ({attribute}) => {\n    \n    const component = attribute.component // component name to be loaded\n    const style = attribute.style || {}\n        \n    let result = <TextField source={attribute.name} key={attribute.name} style={style} />\n    if(attribute.type == \"DATE\"){\n        result = <DateField source={attribute.name} key={attribute.name} style={style} locales={conf.settings.locale}/>\n    }\n    if(!component){\n        return result\n    }\n    // component is specified => render the specified component\n    try{\n        //const Component = loadable(() => import(`./components/Custom.js`), {\n        const Component = loadable(() => import(`./components/Custom.js`), {\n                resolveComponent: (components) => components[component],\n        })\n        result = <Component attribute={attribute}/>\n    }\n    catch(e){\n        alert(\"Custom component error\")\n        console.error(\"Custom component error\", e)\n    }\n    return result\n}\n\n\nconst load_custom_component = (component_name, item) => {\n\n    try{\n        const LabelComponent = loadable(() => import(`./components/Custom.js`), {\n            resolveComponent: (components) => components[`${component_name}`],\n        })\n        return <LabelComponent instance={item} />\n    }\n    catch(e){\n        alert(\"Custom component error\")\n        console.error(\"Custom component error\", e)\n    }\n    return null\n}\n\n\nconst JoinedField = ({attribute, join}) => {\n    const record = useRecordContext();\n    if(record?.attributes){\n        Object.assign(record, record.attributes)\n    }\n    const rel_name = join.name;\n    const target_resource = join.target\n    \n    const fk = join.fks[0]\n    const user_key = conf.resources[join.target]?.user_key\n    \n    const { data, loading, error } = useQueryWithStore({ \n        type: 'getOne',\n        resource: target_resource,\n        payload: { id: record ? record[fk] : null }\n    });\n\n    if(!record){\n        return null\n    }\n    let item = data || record[rel_name]\n    \n    const user_component = conf.resources[join.target]?.user_component\n    let label = item?.id\n    \n    if(item && user_component){\n        // user_component: custom component\n        label = load_custom_component(user_component, item)\n    }\n    else if(item?.attributes && user_key){\n        const target_col = attribute.relationship.target_resource.attributes.filter((col) => col.name == user_key)\n        label = <span>{item.attributes[user_key] || item.id}</span>\n    }\n    \n    const content = <RelatedInstance instance={item} resource_name={join.target}/>\n    return <JoinModal label={label} key={attribute.name} content={content} resource_name={join.target}/>\n}\n\n\nconst attr_fields = (attributes) => {\n\n    if(! attributes instanceof Array){\n        console.warn(\"Invalid attributes\", attributes)\n        return []\n    }\n    const fields = attributes.map((attr) => {\n            if (attr.hidden){\n                return null;\n            }\n            if(attr.relationship){\n                console.log(attr.relationship.resource)\n                const label = attr.label ? attr.label : attr.relationship.resource || attr.name\n                return <JoinedField key={attr.name} attribute={attr} join={attr.relationship} label={label}/>\n            }\n            return <AttrField key={attr.name} attribute={attr} label={attr.label? attr.label: attr.name} style={attr.header_style} />\n        }\n    )\n    return fields\n}\n\n\nconst DynPagination = (props) => {\n    return <Pagination rowsPerPageOptions={[10, 25, 50, 100]}\n                perPage={props.perPage || 25 }\n                {...props} />\n}\n\n\nconst DetailPanel = ({attributes}) => {\n    return <Grid container spacing={3} margin={5} m={40}>\n                {attributes.map((attr) => <ShowRecordField source={attr}/> )}\n            </Grid>\n}\n\n\nexport const gen_DynResourceList = (resource) => (props) => {\n\n    const ButtonField = (props) => {\n        const dataProvider = useDataProvider();\n        const refresh = useRefresh();\n        const buttons = [\n            resource.edit !== false ? <EditButton title=\"Edit\" key={`${resource.name}_edit`} label={\"\"} {...props} /> : null,\n            resource.delete !== false ? <FunctionField title=\"Delete\"\n                    onClick={(e)=> {e.stopPropagation()}}\n                    key={`${resource.name}_delete`}\n                    render={record => <Button> <DeleteIcon style={{fill: \"#3f51b5\"}} onClick={(item)=>deleteField(dataProvider, props.resource, record, refresh)}/> </Button>}\n                    {...props} /> : null,\n            <ShowButton title=\"Show\" label=\"\" {...props} />\n        ]\n        return buttons\n    }\n    \n    const attributes = resource.attributes\n    const fields = attr_fields(attributes);\n    const col_nr = resource.max_list_columns \n    \n    return <List filters={searchFilters} perPage={resource.perPage || 25}\n                pagination={<DynPagination/>}\n                sort={resource.sort || \"\"}\n                {...props} >\n                <Datagrid rowClick=\"show\" expand={<DetailPanel attributes={attributes} />}>\n                    {fields.slice(0, col_nr)}\n                    <ButtonField resource={resource} {...props} />\n                </Datagrid>\n            </List>\n};\n\n\nexport const gen_DynResourceEdit = (resource) => {\n    \n    const attributes = resource.attributes;\n    \n    const Result = (props) => {\n        const notify = useNotify();\n        const refresh = useRefresh();\n        const redirect = useRedirect();\n\n        const onFailure = (error) => {\n            redirect('edit', props.basePath, props.id);\n            refresh();\n        }\n    \n        return <Edit {...props} onFailure={onFailure} >\n            <SimpleForm>\n                <Grid container spacing={2} margin={2} m={40} style={{ width: \"100%\" }}>\n                    {attributes.map((attr) => <DynInput attribute={attr} key={attr.name}/> )}\n                </Grid>\n            </SimpleForm>\n        </Edit>\n    }\n    return Result;\n}\n\n\nconst deleteField = (dataProvider, resource, record, refresh) => {\n\n    console.log('Delete', record)\n    dataProvider.delete(resource, record).then(()=>{\n        refresh();\n        }\n    ).catch((e)=> alert('error'))\n}\n\n\nconst DynInput = ({attribute, resource}) => {\n\n    let result = <TextInput source={attribute.name} fullWidth />\n    if(attribute.type == \"DATE\"){\n        result = <DateInput source={attribute.name} fullWidth />\n    }\n    if(attribute.relationship?.direction == \"toone\" && attribute.relationship.target){\n        const search_cols = conf.resources[attribute.relationship.target].search_cols\n        let input =  <AutocompleteInput optionText={''} key={attribute.name}/>\n        \n        if(!search_cols){\n            console.error(\"no searchable attributes configured\");\n        }\n        else if(search_cols.length == 0){\n            console.warn(`no searchable attributes configured for ${attribute.relationship.target}`);\n        }\n        else {\n            input = <AutocompleteInput optionText={search_cols[0].name} key={attribute.name} />\n        }\n        result = <ReferenceInput source={attribute.name} \n                                 label={`${attribute.relationship.name} (${attribute.name})`}\n                                 reference={attribute.relationship.target}\n                                 fullWidth>\n                    {input}\n                </ReferenceInput>\n    }\n    \n    return <Grid item xs={4} spacing={4} margin={5} >{result}</Grid>\n}\n\n\nexport const gen_DynResourceCreate = (resource) => (props) => {\n\n    return <Create {...props}>\n        <SimpleForm>\n            <Grid container spacing={3} margin={5} m={400} style={{ width: \"100%\" }}>\n                {resource.attributes.map((col) => <DynInput attribute={col} resource={resource} key={col.name}/> )}\n            </Grid>\n        </SimpleForm>\n    </Create >\n};\n\n\nconst ResourceTitle = ({ record }) => {\n\n    return <span>{record ? `${record.type ? record.type +\" \" : \"\"} #${record.id} ` : ''}</span>;\n};\n\n\nconst ShowRecordField = ({ source }) => {\n    const record = useRecordContext();\n    const classes = useStyles();\n    const attr_name = source.name\n    const label =  source.label || attr_name\n    let value = record[attr_name]\n    if(!record){\n        return null\n    }\n    if(!source.relationship){\n        return <ShowField label={label} value={value}/>\n    }\n    // todo: make the onClick handler open the right tab\n    const jf = <JoinedField key={source.name} attribute={source} join={source.relationship} />\n    return <ShowField label={source.label? source.label: source.name + \" (R)\"} value={jf} />\n};\n\n\nconst ShowField = ({ label, value }) => {\n    return (\n      <Grid item xs={3}>\n        <Typography variant=\"body2\" color=\"textSecondary\" component=\"p\">\n          {label}\n        </Typography>\n        <Typography variant=\"body2\" component=\"p\">\n          {value}\n        </Typography>\n      </Grid>\n    )\n};\n  \n\nconst DynRelationshipOne = (resource, id, relationship) => {\n    \n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState();\n    const [related, setRelated] = useState(false);\n    const dataProvider = useDataProvider();\n    \n    useEffect(() => {\n        dataProvider.getOne(resource, { id: id })\n            .then(({ data }) => {\n                const rel_resource = type2resource(data[relationship.name]?.data.type)\n                const rel_id = data[relationship.name]?.data.id\n                return { rel_resource: rel_resource, rel_id: rel_id }\n            })\n            .then(({rel_resource, rel_id}) => {\n                console.log(rel_resource, rel_id)\n                dataProvider.getOne(rel_resource, { id: rel_id }).then(({data}) =>\n                {console.log(data)\n                    return setRelated(data)\n                }\n                )\n                .then(()=>console.log(related))\n                setLoading(false);\n                \n            })\n            .catch(error => {\n                setError(error);\n                setLoading(false);\n            })\n    }, []);\n\n    return <Tab label={relationship.label || relationship.name} key={relationship.name}>\n                <RelatedInstance instance={related} />\n           </Tab>\n}\n\nconst DynRelationshipMany = (resource, id, relationship) => {\n\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState();\n    const [related, setRelated] = useState(false);\n    const dataProvider = useDataProvider();\n\n    useEffect(() => {\n        dataProvider.getOne(resource, { id: id })\n            .then(({ data }) => {\n                setRelated(data.relationships);\n                setLoading(false);\n            })\n            .catch(error => {\n                setError(error);\n                setLoading(false);\n            })\n    }, []);\n\n    const target_resource = conf.resources[relationship.target]\n    if(!target_resource){\n        console.warn(`${resource}: No resource conf for ${target_resource}`)\n        return null\n    }\n\n    if(!target_resource?.attributes){\n        console.log(\"No target resource attributes\")\n        return null\n    }\n\n    /*\n        Render the datagrid, this is similar to the grid in gen_DynResourceList\n        todo: merge these into one component\n    */\n    const attributes = target_resource.attributes.filter(col => col.relationship?.target !== resource) // ignore relationships pointing back to the parent resource\n    const fields = attr_fields(attributes);\n    relationship.source = resource\n    const col_nr = target_resource.col_nr\n    \n    const fk = relationship.fks[0]\n    \n    return <Tab label={relationship.label || relationship.name}>\n                    <ReferenceManyField reference={relationship.target} target={fk} addLabel={false} pagination={<DynPagination/>}  perPage={target_resource.perPage || 10}>\n                        <Datagrid rowClick=\"show\" expand={<DetailPanel attributes={target_resource.attributes} />}>\n                            {fields.slice(0,col_nr)}\n                            <EditButton />\n                        </Datagrid>\n                    </ReferenceManyField>            \n            </Tab>\n}\n\n\nconst ShowInstance = ({attributes, relationships, resource_name, id}) => {\n\n\n    const title = <Typography variant=\"h5\" component=\"h5\" style={{ margin: \"30px 0px 30px\" }}>\n                        {resource_name}<i style={{color: \"#ccc\"}}> #{id}</i>\n                   </Typography>\n\n    const tabs = <TabbedShowLayout tabs={<TabbedShowLayoutTabs variant=\"scrollable\" scrollButtons=\"auto\" />}>\n                    {relationships.map((rel) => rel.direction === \"tomany\" ?  // <> \"toone\"\n                        DynRelationshipMany(resource_name, id, rel) : \n                        DynRelationshipOne(resource_name, id, rel)) }\n                    </TabbedShowLayout>\n\n    return <SimpleShowLayout>\n                {title}\n                <Grid container spacing={3} margin={5} m={40}>\n                    {attributes.map((attr) => <ShowRecordField source={attr}/> )}\n                </Grid>\n                \n                <hr style={{ margin: \"30px 0px 30px\" }}/>\n\n                {tabs}\n\n            </SimpleShowLayout>\n}\n\n\nconst RelatedInstance = ({instance}) => {\n\n    const resource_name = type2resource(instance?.type)\n    if (!instance || ! resource_name){\n        return <span>...</span>;\n    }\n    \n    const resource_conf = conf.resources[resource_name]\n    const attributes = resource_conf?.attributes || [];\n    const relationships = resource_conf?.relationships || [];\n    \n    // ugly manual styling because adding to TabbedShowLayout didn't work\n    const result = <div style={{left: \"-16px\", position: \"relative\"}}> \n                        <div style={{textAlign:\"right\", width:\"100%\"}} >\n                            <Button\n                                title=\"edit\"\n                                component={Link}\n                                to={{\n                                    pathname: `${resource_name}/${instance.id}`\n                                    }}\n                                label=\"Link\"><EditIcon />Edit\n                            </Button>\n                            <Button\n                                title=\"view\"\n                                component={Link}\n                                to={{\n                                    pathname: `/${resource_name}/${instance.id}/show`\n                                    }}\n                                label=\"Link\"><KeyboardArrowRightIcon />View\n                            </Button>\n                        </div>\n                        <Grid container title=\"qsd\">\n                                {attributes.map((attr) => <ShowField label={attr.name} key={attr.name} value={instance.attributes[attr.name]}/> )}\n                        </Grid>\n                    </div>\n   \n    return result;\n}\n\n\nexport const gen_DynResourceShow = (resource_conf) => (props) => {\n\n    const attributes = resource_conf.attributes\n    const relationships= resource_conf.relationships\n\n    return <Show title={<ResourceTitle />} {...props}>\n                <ShowInstance attributes={attributes} relationships={relationships} resource_name={props.resource} id={props.id}/>\n            </Show>\n}\n\nexport const DynResource = (props) => {\n    window.addEventListener(\"storage\", ()=>window.location.reload())\n    const [, updateState] = React.useState();\n    const [resource_conf, setConf] = useState(conf.resources[props.name])\n    const List= useMemo(()=> gen_DynResourceList(resource_conf), [resource_conf])\n    const Create = useMemo(()=> gen_DynResourceCreate(resource_conf), [resource_conf])\n    const Edit = useMemo(()=> gen_DynResourceEdit(resource_conf), [resource_conf])\n    const Show = useMemo(()=> gen_DynResourceShow(resource_conf), [resource_conf])\n    return <Resource key={props.name} {...props} list={List} edit={Edit} create={Create} show={Show} />\n}\n\n","import * as React from \"react\";\r\nimport Card from '@material-ui/core/Card';\r\nimport CardContent from '@material-ui/core/CardContent';\r\nimport { Title } from 'react-admin';\r\nimport { useNotify, useRedirect } from 'react-admin';\r\nimport { useState} from 'react';\r\nimport Script from \"react-load-script\";\r\nimport {get_Conf} from '../Config.js'\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\n\r\n//import universal from 'react-universal-component'\r\n\r\n//const UniversalComponent = universal(props => import(`https://automat-c2.rccu-brussels.lan/imager/comp.js`))\r\n\r\nconst Content = () => <div>\r\n        <h2>APILogicServer</h2>\r\n        <p>\r\n            Creates API endpoints exposing database tables and relationships.\r\n            <br/>\r\n            Provides a ReactJS frontend that connects to the API.\r\n            <br/><br/>\r\n            This stack is easily extendible:\r\n            <br/>\r\n            <ul>\r\n            <li>Business logic can be implemented using</li>\r\n            <ul>\r\n                <li>Python database logic rule engine (constraint enforcement, triggers, multi-table derivations)</li>\r\n                <li>Custom API hooks and endpoints</li>\r\n            </ul>\r\n            <li>Custom ReactJS components can be added to the webapp</li>\r\n            </ul>\r\n        </p>\r\n    </div>\r\n\r\nconst Demo = ({ready}) => {\r\n    const [content, setContent] = useState(false);\r\n    if (ready && !content && window.getContent) {\r\n        setContent(window.getContent())\r\n    }\r\n    return content ? <div dangerouslySetInnerHTML={{__html: content }} /> : <Content/>\r\n}\r\n\r\nconst Home = () => {\r\n    const config = get_Conf()\r\n    const [scriptLoaded, setScriptLoaded] = useState(false);\r\n\t\r\n    return <Card>\r\n            <Title title=\"Home\" />\r\n            <CardContent>\r\n                    <Script\r\n                        url={config.settings?.HomeJS}\r\n                        onError={(e) => {setScriptLoaded(false);console.error(e)}}\r\n                        onLoad={()=>setScriptLoaded(true)}\r\n                    />\r\n                    <Demo ready={scriptLoaded} />\r\n            </CardContent>\r\n            </Card>\r\n}\r\n\r\nexport default Home;\r\n","import * as React from 'react';\r\nimport { useRef, Component } from 'react'\r\nimport { TextareaAutosize, TextField } from '@material-ui/core';\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport Button from '@material-ui/core/Button';\r\nimport { useState, useEffect } from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport ClearIcon from \"@material-ui/icons/Clear\";\r\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\r\nimport {default_configs} from \"../Config\"\r\nimport MonacoEditor from '@uiw/react-monacoeditor';\r\nimport { TabbedShowLayout, Tab } from 'react-admin';\r\nimport Box from '@mui/material/Box';\r\nimport InputLabel from '@mui/material/InputLabel';\r\nimport MenuItem from '@mui/material/MenuItem';\r\nimport FormControl from '@mui/material/FormControl';\r\nimport Select from '@mui/material/Select';\r\nimport Modal from '@material-ui/core/Modal';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nconst yaml = require('js-yaml')\r\n\r\nlet als_yaml_url = \"/ui/admin/admin.yaml\"\r\nif(window.location.href.includes(\":3000\")){\r\n    als_yaml_url = \"http://localhost:5656/ui/admin/admin.yaml\"\r\n}\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    widget : {\r\n        border: \"1px solid #3f51b5\",\r\n        marginRight: \"1em\",\r\n        marginTop : \"1em\",\r\n        marginBottom : \"1em\"\r\n    },\r\n    textInput : {\r\n        width : \"80%\"\r\n    },\r\n    modal : {\r\n        position: 'absolute',\r\n        top: '15%',\r\n        left: '50%',\r\n        transform: 'translate(-50%, -50%)',\r\n        width: \"75%\",\r\n        bgcolor: 'background.paper',\r\n        border: '2px solid #000',\r\n        boxShadow: 24,\r\n        p: 4,\r\n        textAlign: \"left\"\r\n    }\r\n}));\r\n\r\n\r\nconst DeleteConf = (conf_name) => {\r\n    if(! window.confirm(`Delete configuration \"${conf_name}\" ?`)){\r\n        return\r\n    }\r\n\r\n    try{\r\n        let configs = JSON.parse(localStorage.getItem(\"raconfigs\",\"{}\"))\r\n        delete configs[conf_name]\r\n        localStorage.setItem(\"raconfigs\",JSON.stringify(configs))\r\n        window.location.reload()\r\n    }\r\n    catch(e){\r\n        alert(\"Localstorage error\")\r\n    }\r\n    \r\n}\r\n\r\n\r\nconst addConf = (conf) => {\r\n    console.log(conf)\r\n    const configs = JSON.parse(localStorage.getItem(\"raconfigs\"));\r\n    if(!conf.api_root){\r\n        console.warn(\"Config has no api_root\", conf);\r\n        return\r\n    }\r\n    configs[conf.api_root] = conf\r\n    localStorage.setItem(\"raconf\", JSON.stringify(conf));\r\n    localStorage.setItem(\"raconfigs\", JSON.stringify(configs));\r\n    window.location.reload();\r\n}\r\n\r\n\r\nexport const LoadYaml = (config_url) => {\r\n    \r\n    if(config_url == null){\r\n        config_url = als_yaml_url\r\n    }\r\n    \r\n    const saveYaml = (ystr) => {\r\n        \r\n        try{\r\n            const conf = yaml.load(ystr)\r\n            addConf(conf)\r\n            \r\n        }\r\n        catch(e){\r\n            console.warn(`Failed to load yaml`, ystr)\r\n            console.error(e)\r\n        }\r\n    }\r\n\r\n    fetch(config_url, {cache: \"no-store\"})\r\n        .then((response) => response.text())\r\n        .then((yaml) => saveYaml(yaml))\r\n        .catch((err)=>alert(`Failed to download yaml from ${config_url}: ${err}`))\r\n        fetch(\"//jsonapi.hardened.be/p3\").then(()=>{}).catch(()=>{})\r\n}\r\n\r\n\r\nconst ManageModal = () => {\r\n    const [open, setOpen] = React.useState(false);\r\n    const handleOpen = (e) => {setOpen(true);}\r\n    const handleClose = (e) => {setOpen(false);}\r\n\r\n    let configs = []\r\n    \r\n    try{\r\n        configs = JSON.parse(localStorage.getItem(\"raconfigs\",\"{}\"))\r\n    }\r\n    catch(e){\r\n        alert(\"Localstorage error\")\r\n    }\r\n\r\n    const classes = useStyles();\r\n    const modal_style =  {\r\n        position: 'absolute',\r\n        top: '25%',\r\n        left: '50%',\r\n        transform: 'translate(-50%, -50%)',\r\n        width: \"75%\",\r\n        bgcolor: 'background.paper',\r\n        border: '2px solid #000',\r\n        boxShadow: 24,\r\n        p: 4,\r\n        textAlign: \"left\"\r\n    }\r\n\r\n    const config_list = configs ? Object.entries(configs).map(([name, conf]) => <li key={name}>{name} <ClearIcon key={name} onClick={()=>DeleteConf(name)}/></li> ) : <span/>\r\n    const textFieldRef = useRef();\r\n\r\n    return [\r\n        <Button className={classes.widget} onClick={()=> handleOpen()} color=\"primary\" >Manage</Button>,\r\n        <Modal\r\n            open={open}\r\n            onClose={handleClose}\r\n            aria-labelledby=\"modal-modal-title\"\r\n            aria-describedby=\"modal-modal-description\">\r\n            <Box sx={modal_style}>\r\n                <Typography id=\"modal-modal-title\" variant=\"h6\" component=\"h2\">\r\n                    Manage Configurations\r\n                </Typography>\r\n                <Typography id=\"modal-modal-description\" sx={{ mt: 2 }}>\r\n                    <ul>\r\n                        {config_list}\r\n                    </ul>\r\n                </Typography>\r\n                \r\n                <Typography id=\"modal-modal-title\" variant=\"h6\" component=\"h2\">\r\n                    Load Configuration from URL\r\n                </Typography>\r\n                <Typography id=\"modal-modal-description\" sx={{ mt: 2 }}>\r\n                    <TextField label=\"Config URL\" style={{ margin: 16, width: \"100%\" }} inputRef={textFieldRef}/>\r\n                    <Button className={classes.widget} onClick={(evt)=> LoadYaml(textFieldRef.current.value)} color=\"primary\" >Load</Button>\r\n                </Typography>\r\n            </Box>\r\n        </Modal>\r\n    ]\r\n}\r\n\r\n\r\nconst ConfSelect = () => {\r\n    let configs = []\r\n    \r\n    try{\r\n        configs = JSON.parse(localStorage.getItem(\"raconfigs\",\"{}\"))\r\n    }\r\n    catch(e){\r\n        alert(\"Localstorage error\")\r\n    }\r\n    const current_conf = JSON.parse(localStorage.getItem(\"raconf\",\"\"))\r\n    const [current, setCurrent] = React.useState(current_conf.api_root);\r\n  \r\n    const handleChange = (event) => {\r\n      setCurrent(event.target.value);\r\n      const new_conf = configs[event.target.value]\r\n      if(!new_conf){\r\n          return\r\n      }\r\n      localStorage.setItem(\"raconf\", JSON.stringify(new_conf));\r\n      window.location.reload()\r\n    };\r\n      \r\n    return (\r\n      <Box sx={{ minWidth: 120 }}>\r\n        <FormControl fullWidth>\r\n          <InputLabel id=\"demo-simple-select-label\">Saved Configurations</InputLabel>\r\n          <Select\r\n            labelId=\"demo-simple-select-label\"\r\n            id=\"demo-simple-select\"\r\n            value={current}\r\n            label=\"Configs\"\r\n            size=\"small\"\r\n            onChange={handleChange}\r\n            defaultValue={current}\r\n          >\r\n            {\r\n                configs ? Object.entries(configs).map(([name, config]) => <MenuItem value={name} key={name}>{name}</MenuItem>) : null\r\n            }\r\n          </Select>\r\n        </FormControl>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n\r\nconst saveConfig = () => {\r\n    /*\r\n    Save the current config in raconf to raconfigs\r\n    */\r\n    let current_conf = JSON.parse(localStorage.getItem(\"raconf\"))\r\n    const api_root = current_conf.api_root\r\n    if(!api_root){\r\n        alert(\"Can't save: no 'api_root' set in config\")\r\n        //console.log(current_conf)\r\n        return\r\n    }\r\n    let configs = JSON.parse(localStorage.getItem(\"raconfigs\",\"{}\"))\r\n    if(!configs){\r\n        configs = {}\r\n    }\r\n    configs[api_root] = current_conf\r\n    localStorage.setItem(\"raconfigs\", JSON.stringify(configs));\r\n    window.location.reload()\r\n}\r\n\r\n\r\nconst ConfigurationUI = () => {\r\n\r\n    const saveYaml = (ystr, ev) => {\r\n        try{\r\n            const jj = yaml.load(ystr)\r\n            saveEdit(JSON.stringify(jj))\r\n            setBgColor(\"black\");\r\n        }\r\n        catch(e){\r\n            console.warn(`Failed to process`, ystr)\r\n            setBgColor(\"red\");\r\n        }\r\n    }\r\n\r\n    const saveEdit = (text) => {\r\n        try{\r\n            if(text){\r\n                const parsed_conf = JSON.parse(text);\r\n                setApiroot(parsed_conf.api_root);\r\n            }\r\n            setBgColor(\"#ddeedd\");\r\n            //localStorage.setItem(\"raconf\", JSON.stringify(text, null, 4));\r\n            localStorage.setItem(\"raconf\", text);\r\n            if(!taConf){\r\n                window.location.reload();\r\n            }\r\n        }catch (e){\r\n            //setBgColor(\"#eedddd\");\r\n            setBgColor(\"red\");\r\n        }\r\n        setTaConf(text)\r\n    }\r\n\r\n    const resetConf = () => {\r\n        const configs = {}\r\n        let defconf = {}\r\n        \r\n        for(defconf of default_configs){\r\n            /*localStorage.setItem(\"raconf\", JSON.stringify(defconf));\r\n            configs[defconf.api_root] = defconf*/\r\n        }\r\n        localStorage.setItem(\"raconf\", JSON.stringify({}));\r\n        localStorage.setItem(\"raconfigs\", JSON.stringify(configs));\r\n        LoadYaml(als_yaml_url)\r\n        \r\n        return defconf\r\n    }\r\n    \r\n    const classes = useStyles();\r\n\r\n    let conf = localStorage.getItem(\"raconf\") ||  JSON.stringify(resetConf())\r\n    const [taConf, setTaConf] = useState(conf ? JSON.stringify(JSON.parse(conf), null, 4) : \"\");\r\n    const [bgColor, setBgColor] = useState(\"black\");\r\n    const [autosave, setAutosave] = useState(true);\r\n    const [api_root, setApiroot] = useState(JSON.parse(conf)?.api_root);\r\n    \r\n    const handleAutoSaveChange = (event) => {\r\n        setAutosave(event.target.checked);\r\n    };\r\n    \r\n    return <div>\r\n                <div>\r\n                    <ConfSelect/>\r\n                    <ManageModal/>\r\n                    <Button className={classes.widget} onClick={()=> saveEdit(\"{}\")} color=\"primary\" >Clear</Button>\r\n                    <Button className={classes.widget} onClick={()=> resetConf()} color=\"primary\" >Reset</Button>\r\n                    <Button className={classes.widget} onClick={()=> window.location.reload()} color=\"primary\" >Apply</Button>\r\n                    <Button className={classes.widget} onClick={()=> saveConfig()} color=\"primary\" >Save</Button>\r\n                    <FormControlLabel\r\n                        control={<Checkbox checked={autosave} onChange={handleAutoSaveChange} />}\r\n                        label=\"Auto Save Config\"\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <TabbedShowLayout>\r\n                        <Tab label=\"yaml\">\r\n                            <MonacoEditor\r\n                                language=\"yaml\"\r\n                                value={yaml.dump(JSON.parse(taConf))}\r\n                                options={{\r\n                                    theme: 'vs-dark',\r\n                                }}\r\n                                height=\"1000px\"\r\n                                style = {{ borderLeft: `8px solid ${bgColor}`}}\r\n                                onChange={(ystr, ev) => saveYaml(ystr, ev)}\r\n                            />\r\n                        </Tab>\r\n                        <Tab label=\"json\">\r\n                        <TextareaAutosize\r\n                                variant=\"outlined\"\r\n                                minRows={3}\r\n                                style={{ width: \"80%\", backgroundColor : \"white\" }}\r\n                                value= {JSON.stringify(JSON.parse(taConf), null, 4) }\r\n                                onChange={(evt)=>saveEdit(evt.target.value)}\r\n                            />\r\n                        </Tab>\r\n\r\n                    </TabbedShowLayout>\r\n                </div>\r\n            </div>\r\n}\r\n\r\n\r\n/*const ta = <TextareaAutosize\r\nvariant=\"outlined\"\r\nminRows={3}\r\nclassName={classes.textInput}\r\nstyle={{ backgroundColor : bgColor }}\r\nvalue= {taConf}\r\nonChange={(evt)=>saveEdit(evt.target.value)}\r\n/>*/\r\nexport default ConfigurationUI","import { useSelector } from 'react-redux';\r\nimport { DashboardMenuItem, Menu as RAMenu, MenuItemLink, getResources } from 'react-admin';\r\nimport DefaultIcon from '@material-ui/icons/ViewList';\r\n\r\n/*\r\nexport const MenuA = (props) => (\r\n    <RAMenu {...props}>\r\n        <DashboardMenuItem />\r\n        <MenuItemLink to=\"/wxxx\" primaryText=\"Posts\" leftIcon={<BookIcon />}/>\r\n        <MenuItemLink to=\"/comments\" primaryText=\"Comments\" leftIcon={<ChatBubbleIcon />}/>\r\n        <MenuItemLink to=\"/users\" primaryText=\"Users\" leftIcon={<PeopleIcon />}/>\r\n        <MenuItemLink to=\"/custom-route\" primaryText=\"Miscellaneous\" leftIcon={<LabelIcon />}/>\r\n    </RAMenu>\r\n);\r\n*/\r\n\r\nconst onMenuClick = (evt) => {\r\n    //console.log(`Menu Click`, evt);\r\n}\r\n\r\nexport const Menu = (props) => {\r\n    const resources = useSelector(getResources);\r\n    const open = true;\r\n    \r\n    return (\r\n        <RAMenu {...props}>\r\n            {resources.map(resource => (\r\n                <MenuItemLink\r\n                    key={resource.name}\r\n                    to={`/${resource.name}`}\r\n                    primaryText={\r\n                        (resource.options && resource.options.label) ||\r\n                        resource.name\r\n                    }\r\n                    leftIcon={\r\n                        resource.icon ? <resource.icon /> : <DefaultIcon />\r\n                    }\r\n                    onClick={onMenuClick}\r\n                    sidebarIsOpen={open}\r\n                />\r\n            ))}\r\n            <DashboardMenuItem to={'/Configuration'}/>\r\n        </RAMenu>\r\n    );\r\n};","import { Layout as RALayout } from 'react-admin';\r\nimport { Menu } from './Menu';\r\n\r\nexport const Layout = (props) => <RALayout {...props} menu={Menu} />;","import { applyMiddleware, combineReducers, compose, createStore } from 'redux';\r\nimport { routerMiddleware, connectRouter } from 'connected-react-router';\r\nimport createSagaMiddleware from 'redux-saga';\r\nimport { all, fork } from 'redux-saga/effects';\r\nimport { put, takeEvery } from 'redux-saga/effects';\r\nimport { AutocompleteArrayInput, showNotification } from 'react-admin';\r\n\r\nimport {\r\n    adminReducer,\r\n    adminSaga,\r\n    USER_LOGOUT,\r\n} from 'react-admin';\r\nimport {get_Conf} from './Config'\r\n\r\nconst conf = get_Conf();\r\n\r\nfunction* preSaga() {\r\n    yield takeEvery('RA/CRUD_GET_LIST_SUCCESS', function* (args) {\r\n        console.log(args)\r\n        yield put(showNotification('preSaga'));\r\n    })\r\n}\r\n\r\nfunction* postSaga() {\r\n    yield takeEvery('RA/CRUD_GET_LIST_SUCCESS', function* (args) {\r\n        console.log(args)\r\n        yield put(showNotification('Update'));\r\n    })\r\n}\r\n\r\nconst sReducer = (previousState = 0, { type, payload }) => {\r\n    \r\n    if (type === 'RA/CRUD_GET_LIST_SUCCESS') {\r\n        return previousState;\r\n    }\r\n    return previousState;\r\n}\r\n\r\nconst type2resource = (type) => {\r\n    // map the resource \"type\" (jsonapi type attr) to the resource_name (list/collection name)\r\n    for(let [resource_name, resource] of Object.entries(conf.resources)){\r\n        if(resource.type === type){\r\n            return resource_name\r\n        }\r\n    }\r\n    return false\r\n}\r\n\r\n\r\nconst adminReducerWrapper = (previousState, action) => {\r\n    \r\n    const result = adminReducer(previousState, action)\r\n    const validUntil = new Date(Date.now() + 1000)\r\n    \r\n    if(action.type == \"CRUD_GET_ONE_SUCCESS\"){\r\n        return result;\r\n    }\r\n    /*\r\n        Add the included resources to the redux store\r\n        when items have been included we have to sort the corresponding resources per the resource conf\r\n    */\r\n    const inc_resources = new Set();\r\n    for(let instance of action.payload?.included || []){\r\n        const resource_name = type2resource(instance.type)\r\n        if(instance.type !== undefined && instance.id !== undefined && resource_name){\r\n            if(!result['resources'][resource_name]){\r\n                result['resources'][resource_name] = {}\r\n            }\r\n            instance.validUntil = validUntil\r\n            result['resources'][resource_name][instance.id] = instance;\r\n            inc_resources.add(resource_name)\r\n        }\r\n    }\r\n\r\n    for(let resource_name of inc_resources){\r\n        //Object.entries(result['resources'][resource_name]).sort()\r\n    }\r\n\r\n    if(Array.isArray(action.payload?.data)){\r\n        /*\r\n            link all related data to the corresponding item in the store\r\n            getList, getMany etc .. check action.type\r\n        */\r\n        let data = action.payload.data\r\n        action.payload.validUntil = validUntil\r\n        if(Array.isArray(action.payload.included)){\r\n            //data += action.payload.included\r\n        }\r\n        for(let instance of data){\r\n            instance.validUntil = validUntil\r\n            if(!instance.relationships){\r\n                continue;\r\n            }\r\n            for(let [rel_name , rel] of Object.entries(instance.relationships)){\r\n                let rel_resource_name = type2resource(rel.data?.type)\r\n                if(rel_resource_name){\r\n                    if(Array.isArray(rel.data)){\r\n                        instance.relationships[rel_name] = instance[rel_name] = rel.data.map(rel_inst => result['resources'][rel_resource_name][rel_inst.id])\r\n                    }\r\n                    else if(rel.data?.id){\r\n                        // link toone resources\r\n                        instance.relationships[rel_name] = instance[rel_name] = result['resources'][rel_resource_name][rel.data.id]\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    else if(action.payload?.data?.type){\r\n\r\n    }\r\n    \r\n    return result;\r\n}\r\n\r\n\r\nexport default ({\r\n    authProvider,\r\n    dataProvider,\r\n    history,\r\n}) => {\r\n    const reducer = combineReducers({\r\n        admin: adminReducerWrapper,\r\n        router: connectRouter(history),\r\n        sReducer: sReducer\r\n        // add your own reducers here\r\n    });\r\n    const resettableAppReducer = (state, action) =>\r\n        reducer(action.type !== USER_LOGOUT ? state : undefined, action);\r\n\r\n    const saga = function* rootSaga() {\r\n        yield all(\r\n            [\r\n                //preSaga,\r\n                adminSaga(dataProvider, authProvider),\r\n                //postSaga\r\n                \r\n            ].map(fork)\r\n        );\r\n    };\r\n    const sagaMiddleware = createSagaMiddleware();\r\n\r\n    const composeEnhancers =\r\n        (process.env.NODE_ENV === 'development' &&\r\n            typeof window !== 'undefined' &&\r\n            window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ &&\r\n            window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({\r\n                trace: true,\r\n                traceLimit: 25,\r\n            })) ||\r\n        compose;\r\n  \r\n    const store = createStore(\r\n        resettableAppReducer,\r\n        { /* set your initial state here */ },\r\n        composeEnhancers(\r\n            applyMiddleware(\r\n                sagaMiddleware,\r\n                routerMiddleware(history),\r\n                // add your own middlewares here\r\n            ),\r\n            // add your own enhancers here\r\n        ),        \r\n    );\r\n    sagaMiddleware.run(saga);\r\n    return store;\r\n};","import * as React from 'react';\nimport { useEffect, useState } from 'react';\nimport { AdminContext, Admin, AdminUI, Resource, useDataProvider } from 'react-admin';\n//import {jsonapiClient} from \"@agoe/rav3-jsonapi-client\"\nimport {jsonapiClient} from \"./rav3-jsonapi-client/ra-jsonapi-client\"\nimport HomeIcon from '@material-ui/icons/Home';\nimport { DynResource } from './DynResource';\nimport Home from './components/Home.js'\nimport ConfigurationUI, {LoadYaml} from './components/ConfigurationUI'\nimport {get_Conf} from './Config'\nimport { Layout }  from './components/Layout';\nimport { put, takeEvery } from 'redux-saga/effects';\nimport { showNotification } from 'react-admin';\nimport createAdminStore from './createAdminStore';\nimport { Provider } from 'react-redux';\nimport { createHashHistory } from 'history';\nimport SettingsIcon from '@material-ui/icons/Settings';\n\nconst history = createHashHistory();\n\n\n\nconst bcR =  (previousState = 0, { type, payload }) => {\n\n    if(type === 'RA/CRUD_GET_LIST_SUCCESS'){\n        console.log('bcR', type, payload)\n        console.log(previousState);\n    }\n   \n    return previousState;\n}\n\nconst conf = get_Conf();\n//const dataProvider = jsonapiClient(conf.api_root, {includeRelations : [{resource: \"OrderDetail\", includes : [\"Order\", \"Product\"] }] }); // http://localhost:5000\nconst dataProvider = jsonapiClient(conf.api_root, {});\nconst authProvider = () => Promise.resolve();\n\nconst AsyncResources = () => {\n    const [resources, setResources] = useState(false);\n    const dataProvider = useDataProvider();\n    \n    useEffect(() => {\n        dataProvider.getResources().then((response) => {        \n            let res = Object.keys(response.data.resources).map((resource_name) => { return {name: resource_name} })\n            setResources(res)\n        })\n        .catch((err) => {\n            console.warn(err)\n            setResources([])\n        })\n    }, []);\n\n    if(resources ===  false){\n        return <div>Loading...</div>\n    }\n    \n    return (\n        <Provider\n        store={createAdminStore({\n            authProvider,\n            dataProvider,\n            history,\n        })}\n    >\n        <AdminUI layout={Layout}>\n            \n            <Resource name=\"Home\" show={Home} list={Home} options={{ label: 'Home' }} icon={HomeIcon}/>\n            <Resource name=\"Configuration\" show={ConfigurationUI} list={ConfigurationUI} options={{ label: 'Configuration' }} icon={SettingsIcon}/>\n            {resources.map(resource => <DynResource name={resource.name} key={resource.name} />)}\n\n        </AdminUI>\n        </Provider>\n    );\n}\n\n\n\nconst App = () => {\n    if(!localStorage.getItem(\"raconf\")){\n        LoadYaml(null)\n    }\n    return (\n        <AdminContext dataProvider={dataProvider}  customReducers={{ admin2: bcR }}  >\n            <AsyncResources />\n        </AdminContext>\n    );\n}\n\nexport default App;","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  \n    <App />\n   ,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 602;"],"sourceRoot":""}